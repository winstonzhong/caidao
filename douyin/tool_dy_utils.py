import pandas as pd
import re
import tool_time
import numpy as np
from collections import Counter


def ç½‘å‹è¯„è®ºè§£æ(line: str) -> list[dict]:
    """
    è§£æå•è¡Œç½‘å‹è¯„è®ºæ–‡æœ¬ï¼Œæå–å…³é”®ä¿¡æ¯å¹¶è¿”å›å­—å…¸åˆ—è¡¨

    å‚æ•°:
        line: å•è¡Œè¯„è®ºæ–‡æœ¬ï¼ŒåŒ…å«ç½‘å‹ä¿¡æ¯ã€è¡Œä¸ºã€æ—¶é—´ã€bounds boxç­‰

    è¿”å›:
        list[dict]: åŒ…å«ä»¥ä¸‹å­—æ®µçš„å­—å…¸åˆ—è¡¨ï¼š
            - ç½‘å‹åç§°: strï¼Œç½‘å‹çš„æ˜µç§°ï¼ˆæ— åˆ™ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰
            - è¯„è®ºå†…å®¹: strï¼Œè¯„è®º/å›å¤çš„å…·ä½“å†…å®¹ï¼ˆæ— åˆ™ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰
            - æ˜¯å¦éœ€å›å¤: boolï¼Œæ˜¯å¦åŒ…å«"å›å¤è¯„è®º å›å¤,æŒ‰é’®"ç‰¹å¾
            - left: intï¼Œbounds boxå·¦åæ ‡
            - top: intï¼Œbounds boxä¸Šåæ ‡
            - right: intï¼Œbounds boxå³åæ ‡
            - bottom: intï¼Œbounds boxä¸‹åæ ‡

    Doctestæµ‹è¯•ç”¨ä¾‹:
    >>> # æµ‹è¯•1ï¼šä»…åŒ…å«bounds boxçš„ç©ºè¡Œ
    >>> ç½‘å‹è¯„è®ºè§£æ(" (0, 2167, 1080, 2236)")
    {'ç½‘å‹åç§°': '', 'è¯„è®ºå†…å®¹': '', 'æ˜¯å¦éœ€å›å¤': False, 'left': 0, 'top': 2167, 'right': 1080, 'bottom': 2236}
    >>> # æµ‹è¯•2ï¼šèµäº†ä½ çš„è¯„è®ºï¼Œæ— å›å¤æŒ‰é’®
    >>> line2 = "é­æ™“æ¨±Queençš„å¤´åƒ é­æ™“æ¨±Queen èµäº†ä½ çš„è¯„è®º 1åˆ†é’Ÿå‰ (0, 204, 1080, 447)"
    >>> ç½‘å‹è¯„è®ºè§£æ(line2)
    {'ç½‘å‹åç§°': 'é­æ™“æ¨±Queen', 'è¯„è®ºå†…å®¹': '', 'æ˜¯å¦éœ€å›å¤': False, 'left': 0, 'top': 204, 'right': 1080, 'bottom': 447}
    >>> # æµ‹è¯•3ï¼šè¯„è®ºäº†ä½ ï¼ŒåŒ…å«å›å¤æŒ‰é’®ï¼ˆéœ€å›å¤ï¼‰
    >>> line3 = "å”¯æœ‰æ¬¢å–œçš„å¤´åƒ å”¯æœ‰æ¬¢å–œ ç²‰ä¸ è¯„è®ºäº†ä½ : æ–°å¹´å¿«ä¹ 1åˆ†é’Ÿå‰ å›å¤è¯„è®º å›å¤,æŒ‰é’® èµ èµ,æŒ‰é’® (0, 447, 1080, 709)"
    >>> res3 = ç½‘å‹è¯„è®ºè§£æ(line3)
    >>> res3['ç½‘å‹åç§°'], res3['è¯„è®ºå†…å®¹'], res3['æ˜¯å¦éœ€å›å¤']
    ('å”¯æœ‰æ¬¢å–œ', 'æ–°å¹´å¿«ä¹', True)
    >>> res3['left'], res3['top'], res3['right'], res3['bottom']
    (0, 447, 1080, 709)
    >>> # æµ‹è¯•4ï¼šå¸¦è¡¨æƒ…çš„è¯„è®ºå†…å®¹
    >>> line4 = "èŠ±æœ¨è“çš„å¤´åƒ èŠ±æœ¨è“ è¯„è®ºäº†ä½ : æˆ‘ä¹Ÿä¸çŸ¥é“æœ‰å•¥ç”¨[å¤§ç¬‘][å¤§ç¬‘] 23åˆ†é’Ÿå‰ å›å¤è¯„è®º å›å¤,æŒ‰é’® èµ èµ,æŒ‰é’® (0, 622, 1080, 1136)"
    >>> d = ç½‘å‹è¯„è®ºè§£æ(line4)
    >>> d['è¯„è®ºå†…å®¹']
    'æˆ‘ä¹Ÿä¸çŸ¥é“æœ‰å•¥ç”¨[å¤§ç¬‘][å¤§ç¬‘]'
    >>> d["æ˜¯å¦éœ€å›å¤"]
    True
    >>> # æµ‹è¯•5ï¼šä½œè€…å›å¤çš„åœºæ™¯
    >>> line5 = "èŠ±æœ¨è“çš„å¤´åƒ èŠ±æœ¨è“ ä½œè€… å›å¤: æ˜¯çš„ï¼Œäººé—´çƒŸç«æ°”æ¯[å¤§ç¬‘] 32åˆ†é’Ÿå‰ å›å¤è¯„è®º å›å¤,æŒ‰é’® èµ èµ,æŒ‰é’® (0, 1379, 1080, 1711)"
    >>> res5 = ç½‘å‹è¯„è®ºè§£æ(line5)
    >>> res5['ç½‘å‹åç§°'], res5['è¯„è®ºå†…å®¹']
    ('èŠ±æœ¨è“', 'æ˜¯çš„ï¼Œäººé—´çƒŸç«æ°”æ¯[å¤§ç¬‘]')
    >>> res5['æ˜¯å¦éœ€å›å¤']
    False
    >>> # æµ‹è¯•6ï¼šåç§°å«ç‰¹æ®Šå­—ç¬¦çš„åœºæ™¯
    >>> line6 = "å†œæ‘é˜¿å¨Ÿå¸¦å¨ƒè®°ï¼ˆæ–°äººèµ·æ­¥ï¼‰çš„å¤´åƒ å†œæ‘é˜¿å¨Ÿå¸¦å¨ƒè®°ï¼ˆæ–°äººèµ·æ­¥ï¼‰ èµäº†ä½ çš„è¯„è®º 7åˆ†é’Ÿå‰ (0, 1195, 1080, 1438)"
    >>> ç½‘å‹è¯„è®ºè§£æ(line6)['ç½‘å‹åç§°']
    'å†œæ‘é˜¿å¨Ÿå¸¦å¨ƒè®°ï¼ˆæ–°äººèµ·æ­¥ï¼‰'
    >>> # æµ‹è¯•7ï¼šèµäº†ä½ çš„å›¾æ–‡åœºæ™¯
    >>> line7 = "èŠ±æœ¨è“çš„å¤´åƒ èŠ±æœ¨è“ èµäº†ä½ çš„å›¾æ–‡ 23åˆ†é’Ÿå‰ (0, 1136, 1080, 1379)"
    >>> ç½‘å‹è¯„è®ºè§£æ(line7)['è¯„è®ºå†…å®¹']
    ''
    >>> ç½‘å‹è¯„è®ºè§£æ(line7)['æ˜¯å¦éœ€å›å¤']
    False
    """
    # åˆå§‹åŒ–è¿”å›ç»“æœ

    # æ­£åˆ™åŒ¹é…è¡Œæœ«å°¾çš„bounds boxï¼ˆæ•è·left/top/right/bottomï¼‰
    bounds_pattern = re.compile(r"\((\d+),\s*(\d+),\s*(\d+),\s*(\d+)\)$")
    bounds_match = bounds_pattern.search(line)

    # æå–bounds boxåæ ‡ï¼ˆé»˜è®¤0ï¼Œé˜²æ­¢åŒ¹é…å¤±è´¥ï¼‰
    left = int(bounds_match.group(1)) if bounds_match else 0
    top = int(bounds_match.group(2)) if bounds_match else 0
    right = int(bounds_match.group(3)) if bounds_match else 0
    bottom = int(bounds_match.group(4)) if bounds_match else 0

    # å»æ‰bounds boxåçš„çº¯æ–‡æœ¬å†…å®¹ï¼ˆç”¨äºæå–å…¶ä»–ä¿¡æ¯ï¼‰
    text_without_bounds = bounds_pattern.sub("", line).strip()

    # 1. æå–ç½‘å‹åç§°ï¼šåŒ¹é…"çš„å¤´åƒ"åçš„åç§°ï¼ˆç›´åˆ°é‡åˆ°ç²‰ä¸/ä½œè€…/èµäº†/è¯„è®ºäº†ä½ /å›å¤:ç­‰å…³é”®è¯ï¼‰
    # name_pattern = re.compile(
    #     r"çš„å¤´åƒ\s+([^(\s+ç²‰ä¸|\s+ä½œè€…|\s+èµäº†|\s+è¯„è®ºäº†ä½ |\s+å›å¤:)]+)"
    # )
    name_pattern = re.compile(r"(.+?)çš„å¤´åƒ")
    name_match = name_pattern.search(text_without_bounds)
    ç½‘å‹åç§° = name_match.group(1).strip() if name_match else ""

    # 2. æå–è¯„è®ºå†…å®¹ï¼šä¼˜å…ˆåŒ¹é…"è¯„è®ºäº†ä½ :"ï¼Œå…¶æ¬¡åŒ¹é…"å›å¤:"ï¼Œæ— åˆ™ä¸ºç©º
    content_pattern1 = re.compile(r"è¯„è®ºäº†ä½ :\s*(.+?)\s+\d+åˆ†é’Ÿå‰")  # è¯„è®ºä½ çš„åœºæ™¯
    content_pattern2 = re.compile(r"å›å¤:\s*(.+?)\s+\d+åˆ†é’Ÿå‰")  # ä½œè€…å›å¤çš„åœºæ™¯
    content_match1 = content_pattern1.search(text_without_bounds)
    content_match2 = content_pattern2.search(text_without_bounds)
    if content_match1:
        è¯„è®ºå†…å®¹ = content_match1.group(1).strip()
    elif content_match2:
        è¯„è®ºå†…å®¹ = content_match2.group(1).strip()
    else:
        è¯„è®ºå†…å®¹ = ""

    # 3. åˆ¤æ–­æ˜¯å¦éœ€è¦å›å¤ï¼šç²¾ç¡®åŒ¹é…"å›å¤è¯„è®º å›å¤,æŒ‰é’®"
    æ˜¯å¦éœ€å›å¤ = (
        "å›å¤è¯„è®º å›å¤,æŒ‰é’®" in text_without_bounds and content_match1 is not None
    )

    # æ„å»ºç»“æœå­—å…¸å¹¶æ·»åŠ åˆ°åˆ—è¡¨
    return {
        "ç½‘å‹åç§°": ç½‘å‹åç§°,
        "è¯„è®ºå†…å®¹": è¯„è®ºå†…å®¹,
        "æ˜¯å¦éœ€å›å¤": æ˜¯å¦éœ€å›å¤,
        "left": left,
        "top": top,
        "right": right,
        "bottom": bottom,
    }


def ç½‘å‹è¯„è®ºæå–(job, results: list):
    data = []
    for e in results:
        line = f"{job.å…ƒç´ è½¬å­—ç¬¦ä¸²(e)}, {e.bounds}"
        # print(line)
        d = ç½‘å‹è¯„è®ºè§£æ(line)
        d["e"] = e
        d["ç§’æ•°"] = tool_time.ä»å­—ç¬¦ä¸²æå–æ—¶é—´å¹¶è½¬ä¸ºç§’(line, np.nan)[0]
        d["æ˜¯å¦éœ€å›å¤"] = (
            False
            if not d.get("æ˜¯å¦éœ€å›å¤")
            else d.get("ç½‘å‹åç§°") not in job.æ•°æ®.å®šé•¿é˜Ÿåˆ—
        )
        data.append(d)
    return pd.DataFrame(data)


def æå–é“¾æ¥(txt: str) -> list:
    """
    ä»è¾“å…¥æ–‡æœ¬ä¸­æå–æ‰€æœ‰HTTP/HTTPSåè®®çš„é“¾æ¥

    Doctestå•å…ƒæµ‹è¯•ç”¨ä¾‹ï¼š
    >>> æå–é“¾æ¥('1.76 å¤åˆ¶æ‰“å¼€æŠ–éŸ³ï¼Œçœ‹çœ‹ã€æ²³é©¬åŒ…åŒ…çš„èœå›­çš„ä½œå“ã€‘æ˜­æ˜­å¦‚æ„¿ï¼Œå²å²å®‰æ¾œ# çƒ­é—¨ # æŠ–éŸ³ç¾é£Ÿæ¨èå®˜ #... https://v.douyin.com/XrmRMhEVlbk/ 11/20 z@t.eb lcN:/ ')
    ['https://v.douyin.com/XrmRMhEVlbk/']
    >>> æå–é“¾æ¥('æ— é“¾æ¥çš„çº¯æ–‡æœ¬å†…å®¹')
    []
    >>> æå–é“¾æ¥('å¤šä¸ªé“¾æ¥æµ‹è¯•ï¼šhttps://www.baidu.com æµ‹è¯•å†…å®¹ https://www.google.com/index.html ç»“å°¾')
    ['https://www.baidu.com', 'https://www.google.com/index.html']
    >>> æå–é“¾æ¥('httpå¼€å¤´çš„é“¾æ¥ï¼šhttp://example.com/123 abc')
    ['http://example.com/123']
    """
    # æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼šåŒ¹é…http/httpså¼€å¤´ï¼Œç›´åˆ°é‡åˆ°ç©ºç™½å­—ç¬¦ä¸ºæ­¢çš„æ‰€æœ‰å­—ç¬¦
    # https? åŒ¹é…httpæˆ–httpsï¼›:// åŒ¹é…åè®®åçš„å›ºå®šåˆ†éš”ç¬¦ï¼›[^\s]+ åŒ¹é…ä»»æ„éç©ºç™½å­—ç¬¦ï¼ˆç›´åˆ°ç©ºæ ¼ç»“æŸï¼‰
    link_pattern = r"https?://[^\s]+"

    # æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…çš„é“¾æ¥ï¼Œè¿”å›åˆ—è¡¨
    matched_links = re.findall(link_pattern, txt)

    return matched_links


def æ˜¯å¦æ— å†…å®¹(txt: str):
    """
    æ˜¯å¦æ— å†…å®¹ çš„ Docstring

    :param txt: è¯´æ˜
    :type txt: str
    >>> æ˜¯å¦æ— å†…å®¹('ç”±äºæœªæä¾›å…·ä½“çŸ­è§†é¢‘å†…å®¹ï¼Œæ— æ³•ç”Ÿæˆç²¾å‡†è¯„è®º~')
    True
    >>> æ˜¯å¦æ— å†…å®¹(None)
    True
    >>> æ˜¯å¦æ— å†…å®¹('å†…å®¹')
    False
    """
    return re.search("(æ— æ³•ç”Ÿæˆ|é“¾æ¥)", txt) is not None if txt else True


def æ˜¯å¦ä¸ºå›¾æ–‡è§†é¢‘(txt: str) -> bool:
    """
    åˆ¤æ–­è¾“å…¥æ–‡æœ¬æ˜¯å¦åŒ…å«å›¾æ–‡è§†é¢‘çš„æ ¸å¿ƒç‰¹å¾ï¼ˆå›¾ç‰‡+æ•°å­—+ä¸­æ–‡é€—å·+æŒ‰é’®ï¼‰

    å‚æ•°:
        txt: å¾…æ£€æµ‹çš„æ–‡æœ¬å­—ç¬¦ä¸²

    è¿”å›:
        bool: åŒ…å«å›¾æ–‡ç‰¹å¾è¿”å›Trueï¼Œå¦åˆ™è¿”å›False

    Doctestå•å…ƒæµ‹è¯•ç”¨ä¾‹ï¼š
    >>> æ˜¯å¦ä¸ºå›¾æ–‡è§†é¢‘('å…³æ³¨ ç§ä¿¡ï¼ŒæŒ‰é’® èµ¤å£ä»˜ æœªç‚¹èµï¼Œå–œæ¬¢29ï¼ŒæŒ‰é’® 29 è¯„è®º17ï¼ŒæŒ‰é’® è¯„è®º17ï¼ŒæŒ‰é’® 17 æœªé€‰ä¸­ï¼Œæ”¶è—1ï¼ŒæŒ‰é’® 1 åˆ†äº«ï¼ŒæŒ‰é’® åˆ†äº« éŸ³ä¹ï¼Œ@æµæµªçš„é­‚æ–—ç½—åˆ›ä½œçš„åŸå£°ï¼ŒæŒ‰é’® äº’ç›¸å…³æ³¨ å’¸å®å¸‚ | ç„ç´ æ´ @èµ¤å£ä»˜ Â· 15åˆ†é’Ÿå‰ å‘å¸ƒæ—¶é—´ï¼š15åˆ†é’Ÿå‰ ã€ğŸŒºå°å¯’æ—¥Â·èŠ±é—´æš–èˆŸã€‘è½½ä¸€èˆ¹å†¬æ—¥çš„è¯—æ„åœæ³Šä½ çœ¼å‰ã€‚... å±•å¼€ å›¾ç‰‡1ï¼ŒæŒ‰é’® å›¾ç‰‡2ï¼ŒæŒ‰é’® å›¾ç‰‡3ï¼ŒæŒ‰é’® å›¾ç‰‡4ï¼ŒæŒ‰é’® å›¾ç‰‡5ï¼ŒæŒ‰é’® å›¾ç‰‡6ï¼ŒæŒ‰é’® å›¾ç‰‡7ï¼ŒæŒ‰é’® å›¾ç‰‡8ï¼ŒæŒ‰é’® å›¾ç‰‡9ï¼ŒæŒ‰é’® å›¾ç‰‡10ï¼ŒæŒ‰é’® æš‚åœè§†é¢‘ï¼ŒæŒ‰é’®')
    True
    >>> æ˜¯å¦ä¸ºå›¾æ–‡è§†é¢‘('çº¯è§†é¢‘å†…å®¹ï¼Œæ²¡æœ‰å›¾ç‰‡ç›¸å…³æ–‡å­—ï¼Œæš‚åœè§†é¢‘ï¼ŒæŒ‰é’®')
    False
    >>> æ˜¯å¦ä¸ºå›¾æ–‡è§†é¢‘('å›¾ç‰‡0ï¼ŒæŒ‰é’® è¿™æ˜¯åŒ…å«å•æ•°å­—çš„å›¾æ–‡å†…å®¹')
    True
    >>> æ˜¯å¦ä¸ºå›¾æ–‡è§†é¢‘('å›¾ç‰‡100ï¼ŒæŒ‰é’® è¿™æ˜¯åŒ…å«å¤šæ•°å­—çš„å›¾æ–‡å†…å®¹')
    True
    >>> æ˜¯å¦ä¸ºå›¾æ–‡è§†é¢‘('å›¾ç‰‡ï¼ŒæŒ‰é’® æ²¡æœ‰æ•°å­—çš„æƒ…å†µï¼ˆéå›¾æ–‡ï¼‰')
    False
    >>> æ˜¯å¦ä¸ºå›¾æ–‡è§†é¢‘('')
    False
    >>> æ˜¯å¦ä¸ºå›¾æ–‡è§†é¢‘('å›¾ç‰‡abcï¼ŒæŒ‰é’® éæ•°å­—å­—ç¬¦ï¼ˆéå›¾æ–‡ï¼‰')
    False
    """
    # æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ ¸å¿ƒç‰¹å¾ï¼šå›¾ç‰‡+1ä¸ªåŠä»¥ä¸Šæ•°å­—+ä¸­æ–‡é€—å·+æŒ‰é’®
    # \d+ åŒ¹é…1ä¸ªæˆ–å¤šä¸ªæ•°å­—ï¼Œç¡®ä¿æ˜¯"å›¾ç‰‡+æ•°å­—"çš„æ ¼å¼
    pattern = r"å›¾ç‰‡\d+ï¼ŒæŒ‰é’®"

    # ä½¿ç”¨searchæŸ¥æ‰¾æ˜¯å¦å­˜åœ¨åŒ¹é…å†…å®¹ï¼ˆæ‰¾åˆ°1ä¸ªå³å¯åˆ¤å®šï¼‰
    match_result = re.search(pattern, txt)

    # æœ‰åŒ¹é…ç»“æœè¿”å›Trueï¼Œæ— åˆ™è¿”å›False
    return match_result is not None


def æå–ç‚¹èµä¸è¯„è®ºæ•°(txt: str) -> tuple[int, int]:
    """
    ä»æ··åˆæ–‡æœ¬ä¸­æå–ç‚¹èµæ•°ï¼ˆå–œæ¬¢åæ¥çš„æ•°å­—ï¼‰å’Œè¯„è®ºæ•°ï¼ˆè¯„è®ºåæ¥çš„æ•°å­—ï¼‰

    å•å…ƒæµ‹è¯•ç¤ºä¾‹ï¼š
    >>> æå–ç‚¹èµä¸è¯„è®ºæ•°("å…³æ³¨ ç§ä¿¡ï¼ŒæŒ‰é’® å¤§æ¼ é›„é¹° æœªç‚¹èµï¼Œå–œæ¬¢597ï¼ŒæŒ‰é’® 597 è¯„è®º447ï¼ŒæŒ‰é’® è¯„è®º447ï¼ŒæŒ‰é’® 447 æœªé€‰ä¸­ï¼Œæ”¶è—æ”¶è—")
    (597, 447)
    """
    # æ­£åˆ™åŒ¹é…"å–œæ¬¢"åç´§è·Ÿçš„æ•°å­—ï¼ˆæ•è·ç»„æå–æ•°å­—éƒ¨åˆ†ï¼‰
    like_match = re.search(r"å–œæ¬¢(\d+)ï¼ŒæŒ‰é’®", txt)
    ç‚¹èµæ•° = int(like_match.group(1)) if like_match else 0

    # æ­£åˆ™åŒ¹é…"è¯„è®º"åç´§è·Ÿçš„æ•°å­—ï¼ˆæ•è·ç»„æå–æ•°å­—éƒ¨åˆ†ï¼‰
    comment_match = re.search(r"è¯„è®º(\d+)ï¼ŒæŒ‰é’®", txt)
    è¯„è®ºæ•° = int(comment_match.group(1)) if comment_match else 0

    return ç‚¹èµæ•°, è¯„è®ºæ•°


def has_interaction_keywords(text):
    """
    æ£€æµ‹è¾“å…¥æ–‡æœ¬ä¸­æ˜¯å¦åŒ…å«æŒ‡å®šçš„äº’åŠ¨ç±»å…³é”®è¯ä¸­çš„ä»»æ„ä¸€ä¸ªã€‚

    æŒ‡å®šå…³é”®è¯åˆ—è¡¨ï¼šä¸²é—¨ äº’ç²‰ çªœé—¨ äº’åŠ© äº’å…³ äº’èµ äº’è®¿ å›å…³
    åŒ¹é…è§„åˆ™ï¼šä¸¥æ ¼åŒ¹é…å®Œæ•´å…³é”®è¯ï¼ˆåŒºåˆ†å…¨è§’/åŠè§’ã€ç©ºæ ¼åˆ†éš”ç­‰ï¼‰ï¼Œåªè¦åŒ…å«ä»»æ„ä¸€ä¸ªå³è¿”å›Trueã€‚

    å‚æ•°:
        text (str): éœ€è¦æ£€æµ‹çš„æ–‡æœ¬å­—ç¬¦ä¸²ï¼ˆç©ºå­—ç¬¦ä¸²ä¼šè¿”å›Falseï¼‰

    è¿”å›:
        bool: åŒ…å«ä»»æ„ä¸€ä¸ªå…³é”®è¯è¿”å›Trueï¼Œå¦åˆ™è¿”å›False

    ç¤ºä¾‹:
    >>> has_interaction_keywords("æˆ‘æ¥ä¸²é—¨äº†ï¼Œæœ‰ç©ºä¸€èµ·èŠ")  # åŒ…å«"ä¸²é—¨"
    True
    >>> has_interaction_keywords("äº’ç²‰äº’å…³ï¼Œä¸€èµ·æ¶¨ç²‰")  # åŒ…å«"äº’ç²‰"+"äº’å…³"
    True
    >>> has_interaction_keywords("çªœé—¨çš„æœ‹å‹è¯·ç•™æ­¥")  # åŒ…å«"çªœé—¨"ï¼ˆæ³¨æ„å’Œ"ä¸²é—¨"çš„åŒºåˆ«ï¼‰
    True
    >>> has_interaction_keywords("å¤§å®¶äº’ç›¸å¸®åŠ©ï¼Œäº’åŠ©å…±èµ¢")  # åŒ…å«"äº’åŠ©"
    True
    >>> has_interaction_keywords("ç‚¹èµåè®°å¾—å›å…³å“¦")  # åŒ…å«"å›å…³"
    True
    >>> has_interaction_keywords("äº’èµä¸€ä¸‹ï¼Œè°¢è°¢å•¦ï¼")  # åŒ…å«"äº’èµ"ï¼ˆå¸¦æ ‡ç‚¹ï¼‰
    True
    >>> has_interaction_keywords("æœ‰ç©ºäº’ç›¸è®¿é—®ï¼Œäº’è®¿å¢åŠ æ´»è·ƒåº¦")  # åŒ…å«"äº’è®¿"
    True
    >>> has_interaction_keywords("ä»Šå¤©å¤©æ°”ä¸é”™ï¼Œé€‚åˆå‡ºé—¨æ•£æ­¥")  # æ— ä»»ä½•å…³é”®è¯
    False
    >>> has_interaction_keywords("")  # ç©ºæ–‡æœ¬
    False
    >>> has_interaction_keywords("å…³é”®è¯æ˜¯äº’ç²‰å—ï¼Ÿæ˜¯çš„")  # å…³é”®è¯åœ¨å¥å­ä¸­é—´
    True
    >>> has_interaction_keywords("å›å…³")  # ä»…åŒ…å«å•ä¸ªå…³é”®è¯
    True
    >>> has_interaction_keywords("è®°å¾—äº’åŠ©ï¼")  # å…³é”®è¯å¸¦æ„Ÿå¹å·
    True
    >>> has_interaction_keywords("æˆ‘æƒ³è¦äº’è®¿ï¼Œä½ æ„¿æ„å—ï¼Ÿ")  # å…³é”®è¯åœ¨å¥å­ä¸­
    True
    >>> has_interaction_keywords("ä¸²é—¨å’Œçªœé—¨éƒ½ç®—å—ï¼Ÿç®—çš„")  # åŒ…å«ä¸¤ä¸ªç›¸ä¼¼å…³é”®è¯
    True
    >>> has_interaction_keywords("äº’ ç²‰ è¿™æ ·åˆ†å¼€çš„ä¸ç®—")  # å…³é”®è¯è¢«ç©ºæ ¼åˆ†éš”ï¼Œä¸åŒ¹é…
    False
    >>> has_interaction_keywords("äº’èŠ¬ï¼ˆé”™åˆ«å­—ï¼‰ä¸ç®—")  # å…³é”®è¯é”™åˆ«å­—ï¼Œä¸åŒ¹é…
    False
    >>> has_interaction_keywords("å› å…³")  # å…³é”®è¯æ‹†åˆ†ï¼Œä¸åŒ¹é…
    False
    >>> has_interaction_keywords('ã€ä¼™ä¼´è®¡åˆ’ å‘å¸ƒè€…ï¼š@å¢¨å¢¨å¦ˆ(æœ‰å…³å¿…å›)ï¼Œé…æ–‡â€œæ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ï¼Œç»ˆä¼šæˆåŠŸ!å§å¦¹ä»¬ä¸€èµ·åŠ æ²¹!â€')
    True
    """
    # å®šä¹‰éœ€è¦æ£€æµ‹çš„æ ¸å¿ƒå…³é”®è¯åˆ—è¡¨ï¼ˆä¸¥æ ¼æŒ‰ç”¨æˆ·è¦æ±‚ï¼‰
    interaction_keywords = [
        "ä¸²é—¨",
        "äº’ç²‰",
        "çªœé—¨",
        "äº’åŠ©",
        "äº’å…³",
        "äº’èµ",
        "äº’è®¿",
        "å›å…³",
        "æœ‰å…³å¿…å›",
        "ä¼™ä¼´è®¡åˆ’",
    ]

    # éå†å…³é”®è¯åˆ—è¡¨ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ä»»æ„ä¸€ä¸ªå‡ºç°åœ¨æ–‡æœ¬ä¸­
    # ä¸€æ—¦åŒ¹é…åˆ°ç«‹å³è¿”å›Trueï¼Œæå‡æ‰§è¡Œæ•ˆç‡
    for keyword in interaction_keywords:
        if keyword in text:
            return True

    # æœªåŒ¹é…åˆ°ä»»ä½•å…³é”®è¯ï¼Œè¿”å›False
    return False


def ä»æ–‡æœ¬ä¸­æå–ç”¨æˆ·åç§°(txt: str) -> str:
    """
    ä»æ–‡æœ¬å­—ç¬¦ä¸²ä¸­æå–ç›®æ ‡ç”¨æˆ·åï¼Œæå–ä¸åˆ°æ—¶è¿”å›None

    æµ‹è¯•ç”¨ä¾‹ï¼š
    >>> txt1 = '''å…³æ³¨ ç§ä¿¡ï¼ŒæŒ‰é’® æ£®æ£®ç«å±±æ³¥å·¥å‚ æœªç‚¹èµï¼Œå–œæ¬¢3ï¼ŒæŒ‰é’® 3 è¯„è®º3ï¼ŒæŒ‰é’® è¯„è®º3ï¼ŒæŒ‰é’® 3 æœªé€‰ä¸­ï¼Œæ”¶è—æ”¶è—ï¼ŒæŒ‰é’® æ”¶è— åˆ†äº«ï¼ŒæŒ‰é’® åˆ†äº« éŸ³ä¹ï¼Œæ¥è‡ªæ¨¡æ¿çš„åŸå£°ï¼ŒæŒ‰é’® ä¸´æ²‚å¸‚ | ä¸‰ç«‹å¤§å¦ @æ£®æ£®ç«å±±æ³¥å·¥å‚ äº’ç›¸ä¸²é—¨äº† > æš‚åœè§†é¢‘ï¼ŒæŒ‰é’® æå–çš„å›¾ç‰‡ç›¸å…³è¯¦ç»†ä¿¡æ¯å¦‚ä¸‹ï¼š å‘å¸ƒæ—¶é—´ï¼šä¸Šåˆ11:51â€‹æ ¸å¿ƒå†…å®¹ï¼šâ€œä»Šå¤©ç»§ç»­ä¸²é—¨ æµé‡å¢é•¿çœŸå®æœ‰æ•ˆ æ£®æ£®ç«å±± å„ä½å…„å¼Ÿå§å¦¹éƒ½åœ¨å®¶â€â€œä¸´æ²‚å¸‚|ä¸‰ç«‹å¤§å¦ @æ£®æ£®ç«å±±æ³¥å·¥å‚ äº’ç›¸ä¸²é—¨äº†â€â€‹äº’åŠ¨æ•°æ®ï¼š3ä¸ªç‚¹èµã€3ä¸ªæ”¶è—â€‹ç›¸å…³å…¥å£ï¼šå…³æ³¨ã€å•†åŸã€æ¨èã€é¦–é¡µã€æœ‹å‹ã€æ¶ˆæ¯â€‹æ“ä½œåŠŸèƒ½ï¼šåˆ†äº«ã€æ”¶è— éœ€è¦æˆ‘å¸®ä½ ç”Ÿæˆç±»ä¼¼çš„ä¸²é—¨å¼•æµæ–‡æ¡ˆï¼Œé€‚é…ç¤¾äº¤å¹³å°å‘å¸ƒå—ï¼Ÿ'''
    >>> ä»æ–‡æœ¬ä¸­æå–ç”¨æˆ·åç§°(txt1)
    'æ£®æ£®ç«å±±æ³¥å·¥å‚'

    >>> txt2 = '''å…³æ³¨ @å¼ å¼ è¦åŠªåŠ›ï¼ˆæ¶¨ç²‰ä¸­ï¼‰ æœªç‚¹èµï¼Œå–œæ¬¢17ï¼ŒæŒ‰é’® 17 è¯„è®º20ï¼ŒæŒ‰é’® è¯„è®º20ï¼ŒæŒ‰é’® 20 æœªé€‰ä¸­ï¼Œæ”¶è—æ”¶è—ï¼ŒæŒ‰é’® æ”¶è— åˆ†äº«ï¼ŒæŒ‰é’® åˆ†äº« éŸ³ä¹ï¼Œ@å°å°é¹¿åˆ›ä½œçš„åŸå£°ï¼ŒæŒ‰é’® @å¼ å¼ è¦åŠªåŠ›ï¼ˆæ¶¨ç²‰ä¸­ï¼‰ #DOU #çƒ­é—¨ #ä¸²é—¨å„¿ #æµé‡ > æš‚åœè§†é¢‘ï¼ŒæŒ‰é’® ä»æä¾›çš„ç½‘é¡µå†…å®¹æå–åˆ°è¯¥é“¾æ¥å›¾ç‰‡ç›¸å…³çš„è¯¦ç»†ä¿¡æ¯å¦‚ä¸‹ï¼š æ—¶é—´ï¼šåŠå¤œ12:27â€‹å…³è”æ ‡ç­¾ï¼š#DOU#ã€#çƒ­é—¨#ã€#ä¸²é—¨å„¿#ã€#æµé‡#â€‹å‘å¸ƒè´¦å·ï¼š@å¼ å¼ è¦åŠªåŠ›(æ¶¨ç²‰ä¸­)â€‹ç›¸å…³åŠŸèƒ½å…¥å£ï¼šé¦–é¡µã€æ¶ˆæ¯ã€æˆ‘ã€æ”¶è—ã€åˆ†äº«ã€å…³æ³¨ã€å•†åŸæ¨èã€ç‚¹å‡»æ¿€æ´»â€‹æ•°å­—ä¿¡æ¯ï¼š100ã€17ã€20ï¼ˆå…·ä½“å«ä¹‰æœªæ˜ç¡®ï¼Œæ¨æµ‹å¯èƒ½ä¸ºç‚¹èµã€æµè§ˆç›¸å…³æ•°æ®ï¼‰'''
    >>> ä»æ–‡æœ¬ä¸­æå–ç”¨æˆ·åç§°(txt2)
    'å¼ å¼ è¦åŠªåŠ›'

    >>> txt3 = '''å…³æ³¨ ğŸ€æ™“å® æœªç‚¹èµï¼Œå–œæ¬¢309ï¼ŒæŒ‰é’® 309 è¯„è®º364ï¼ŒæŒ‰é’® è¯„è®º364ï¼ŒæŒ‰é’® 364 æœªé€‰ä¸­ï¼Œæ”¶è—3ï¼ŒæŒ‰é’® 3 åˆ†äº«ï¼ŒæŒ‰é’® åˆ†äº« éŸ³ä¹ï¼Œ@ç©¿è¶Šæ—¶ç©ºåˆ›ä½œçš„åŸå£°ï¼ŒæŒ‰é’® @ğŸ€æ™“å® å¸®æˆ‘ç®—ä¸€ä¸‹å¾—ç­‰å¤šä¹…æ‰èƒ½åˆ°äº”åƒç²‰ #çœŸå®ç”Ÿæ´»åˆ†äº«å®˜ å±•å¼€ å›¾ç‰‡1ï¼ŒæŒ‰é’® æš‚åœè§†é¢‘ï¼ŒæŒ‰é’® æ ¸å¿ƒä¿¡æ¯ ç›¸å…³è®¡åˆ’ï¼šæŠ–éŸ³/æŠ–éŸ³ç²¾é€‰APPçš„åˆ›ä½œè€…ä¼™ä¼´è®¡åˆ’ï¼ŒåŠ å…¥åå‘å¸ƒä½œå“å¯æŒ‰å†…å®¹è´¨é‡ã€è·åˆ©æ’­æ”¾ã€æœ‰æ•ˆäº’åŠ¨ã€ç”¨æˆ·ä»·å€¼è®¡ç®—æ”¶ç›Šï¼ˆæ™®é€šä½œå“å¾—åŸºç¡€æ”¶ç›Šï¼Œç²¾é€‰ä½œå“å¾—åŸºç¡€+ç²¾é€‰æ”¶ç›Šï¼‰ã€‚â€‹åŠ å…¥æ¡ä»¶ï¼šæŠ–éŸ³è´¦å·äº’åŠ¨ç²‰ä¸æ•°â‰¥5000ï¼ˆå½“å‰110ï¼Œæœªæ»¡è¶³ï¼‰ã€2022å¹´èµ·å…¬å¼€ä½œå“æ•°>20ï¼ˆå½“å‰364ï¼Œå·²æ»¡è¶³ï¼‰ã€‚â€‹ç”¨æˆ·è¯‰æ±‚ï¼šå½“å‰æ¯å¤©ä»…å¢åŠ 1ä¸ªäº’åŠ¨ç²‰ä¸ï¼Œç–‘æƒ‘éœ€å¤šä¹…è¾¾åˆ°5000ç²‰ã€‚â€‹å…¶ä»–å†…å®¹ï¼šå¹³å°æä¾›ä¸“é¢˜è¯¾ç¨‹ï¼ˆæŠ–éŸ³ä¼˜è´¨è§†é¢‘åˆ›ä½œæŒ‡å—ã€æŠ–éŸ³çƒ­é—¨ç©æ³•æ•™ç¨‹åˆé›†ï¼‰ï¼Œè´¦å·æ”¶åˆ°3æ¡æ¶ˆæ¯ã€‚ éœ€è¦æˆ‘å¸®ä½ ä¼°ç®—æŒ‰å½“å‰æ¶¨ç²‰é€Ÿåº¦è¾¾æˆ5000ç²‰çš„å…·ä½“æ—¶é—´ï¼Œæˆ–æ•´ç†æ¶¨ç²‰æé€Ÿçš„å®ç”¨å»ºè®®å—ï¼Ÿ'''
    >>> ä»æ–‡æœ¬ä¸­æå–ç”¨æˆ·åç§°(txt3)
    'ğŸ€æ™“å®'

    >>> txt4 = '''å…³æ³¨ @æœ‰ä¸ªæœ‹å‹ğŸ‹ æœªç‚¹èµï¼Œå–œæ¬¢6ï¼ŒæŒ‰é’® 6 è¯„è®º3ï¼ŒæŒ‰é’® è¯„è®º3ï¼ŒæŒ‰é’® 3 æœªé€‰ä¸­ï¼Œæ”¶è—æ”¶è—ï¼ŒæŒ‰é’® æ”¶è— åˆ†äº«ï¼ŒæŒ‰é’® åˆ†äº« æ‹åŒæ¬¾ éŸ³ä¹ï¼Œ@NiNié«˜å“é‹åˆ›ä½œçš„åŸå£°ï¼ŒæŒ‰é’® @@æœ‰ä¸ªæœ‹å‹ğŸ‹ æ¥äº†ï¼Œæ¥äº†ï¼Œä¸²é—¨æ¥äº† #æŠ–éŸ³ä¼™ä¼´è®¡åˆ’æ¥äº† #åˆ›ä½œè€…æ‰¶æŒ... å±•å¼€ å›¾ç‰‡1ï¼ŒæŒ‰é’® æš‚åœè§†é¢‘ï¼ŒæŒ‰é’® æ ¸å¿ƒä¿¡æ¯ é¡µé¢åœºæ™¯ï¼šæŠ–éŸ³APPå†…ç›¸å…³åŠŸèƒ½é¡µé¢ï¼ŒåŒ…å«åˆ›ä½œæ‰¶æŒã€ä¼™ä¼´è®¡åˆ’ç­‰å†…å®¹â€‹å…³é”®æ¨¡å—ï¼šâ€‹æŠ–éŸ³ä¼™ä¼´è®¡åˆ’ï¼šåŠ å…¥æ¡ä»¶ä¸ºå¹´é¾„â‰¥18å‘¨å²ã€æŠ–éŸ³è´¦å·äº’åŠ¨ç²‰ä¸æ•°5000ï¼ˆæ˜¾ç¤ºâ€œå·²æ»¡è¶³â€â€œæœªæ»¡è¶³â€çŠ¶æ€ï¼‰â€‹åˆ›ä½œèµ„æºï¼šæŠ–éŸ³ä¼˜è´¨è§†é¢‘åˆ›ä½œæŒ‡å—ã€æŠ–éŸ³çƒ­é—¨ç©æ³•æ•™ç¨‹åˆé›†â€‹å…¶ä»–å†…å®¹ï¼šç”¨æˆ·åŠ¨æ€ï¼ˆâ€œæ¥äº†ï¼Œæ¥äº†ï¼Œæˆ‘è¦æ¥ä¸²é—¨äº†ï¼Œä»Šå¤©ç›®æ ‡300+â€ï¼‰ã€ç›¸å…³è¯é¢˜#æŠ–éŸ³ä¼™ä¼´è®¡åˆ’æ¥äº†#åˆ›ä½œè€…æ‰¶æŒ...â€‹åé¦ˆæ¸ é“ï¼šå‰å¾€ã€ŒæŠ–éŸ³app-æˆ‘-æˆ‘çš„å®¢æœã€åé¦ˆé—®é¢˜â€‹é¡µé¢åŠŸèƒ½å…¥å£ï¼šæ”¶è—ã€åˆ†äº«ã€å‘ä½œå“ã€æ‹åŒæ¬¾ï¼Œåº•éƒ¨æœ‰é¦–é¡µã€æ¶ˆæ¯ã€æˆ‘ç­‰å¯¼èˆªæ  éœ€è¦æˆ‘å¸®ä½ æ•´ç†æˆæ¸…æ™°çš„è¡¨æ ¼å½¢å¼ï¼Œæ–¹ä¾¿å¿«é€ŸæŸ¥çœ‹å…³é”®ä¿¡æ¯å—ï¼Ÿ'''
    >>> ä»æ–‡æœ¬ä¸­æå–ç”¨æˆ·åç§°(txt4)
    'æœ‰ä¸ªæœ‹å‹ğŸ‹'

    >>> txt5 = 'è¿™æ˜¯ä¸€æ®µæ²¡æœ‰æœ‰æ•ˆç”¨æˆ·åçš„æ–‡æœ¬ï¼Œåªæœ‰@å°å°é¹¿åˆ›ä½œçš„åŸå£°ï¼Œæ— ç›®æ ‡ç”¨æˆ·'
    >>> ä»æ–‡æœ¬ä¸­æå–ç”¨æˆ·åç§°(txt5) is None
    True

    >>> txt1 = '''å…³æ³¨ ç§ä¿¡ï¼ŒæŒ‰é’® æ£®æ£®ç«å±±æ³¥å·¥å‚ æœªç‚¹èµï¼Œå–œæ¬¢3ï¼ŒæŒ‰é’® 3 è¯„è®º3ï¼ŒæŒ‰é’® è¯„è®º3ï¼ŒæŒ‰é’® 3 æœªé€‰ä¸­ï¼Œæ”¶è—æ”¶è—ï¼ŒæŒ‰é’® æ”¶è— åˆ†äº«ï¼ŒæŒ‰é’® åˆ†äº« éŸ³ä¹ï¼Œæ¥è‡ªæ¨¡æ¿çš„åŸå£°ï¼ŒæŒ‰é’® ä¸´æ²‚å¸‚ | ä¸‰ç«‹å¤§å¦ @æ£®æ£®ç«å±±æ³¥å·¥å‚ äº’ç›¸ä¸²é—¨äº† > æš‚åœè§†é¢‘ï¼ŒæŒ‰é’® æå–çš„å›¾ç‰‡ç›¸å…³è¯¦ç»†ä¿¡æ¯å¦‚ä¸‹ï¼š å‘å¸ƒæ—¶é—´ï¼šä¸Šåˆ11:51â€‹æ ¸å¿ƒå†…å®¹ï¼šâ€œä»Šå¤©ç»§ç»­ä¸²é—¨ æµé‡å¢é•¿çœŸå®æœ‰æ•ˆ æ£®æ£®ç«å±± å„ä½å…„å¼Ÿå§å¦¹éƒ½åœ¨å®¶â€â€œä¸´æ²‚å¸‚|ä¸‰ç«‹å¤§å¦ @æ£®æ£®ç«å±±æ³¥å·¥å‚ äº’ç›¸ä¸²é—¨äº†â€â€‹äº’åŠ¨æ•°æ®ï¼š3ä¸ªç‚¹èµã€3ä¸ªæ”¶è—â€‹ç›¸å…³å…¥å£ï¼šå…³æ³¨ã€å•†åŸã€æ¨èã€é¦–é¡µã€æœ‹å‹ã€æ¶ˆæ¯â€‹æ“ä½œåŠŸèƒ½ï¼šåˆ†äº«ã€æ”¶è— éœ€è¦æˆ‘å¸®ä½ ç”Ÿæˆç±»ä¼¼çš„ä¸²é—¨å¼•æµæ–‡æ¡ˆï¼Œé€‚é…ç¤¾äº¤å¹³å°å‘å¸ƒå—ï¼Ÿ'''
    >>> ä»æ–‡æœ¬ä¸­æå–ç”¨æˆ·åç§°(txt1)
    'æ£®æ£®ç«å±±æ³¥å·¥å‚'

    >>> txt2 = '''å…³æ³¨ @å¼ å¼ è¦åŠªåŠ›ï¼ˆæ¶¨ç²‰ä¸­ï¼‰ æœªç‚¹èµï¼Œå–œæ¬¢17ï¼ŒæŒ‰é’® 17 è¯„è®º20ï¼ŒæŒ‰é’® è¯„è®º20ï¼ŒæŒ‰é’® 20 æœªé€‰ä¸­ï¼Œæ”¶è—æ”¶è—ï¼ŒæŒ‰é’® æ”¶è— åˆ†äº«ï¼ŒæŒ‰é’® åˆ†äº« éŸ³ä¹ï¼Œ@å°å°é¹¿åˆ›ä½œçš„åŸå£°ï¼ŒæŒ‰é’® @å¼ å¼ è¦åŠªåŠ›ï¼ˆæ¶¨ç²‰ä¸­ï¼‰ #DOU #çƒ­é—¨ #ä¸²é—¨å„¿ #æµé‡ > æš‚åœè§†é¢‘ï¼ŒæŒ‰é’® ä»æä¾›çš„ç½‘é¡µå†…å®¹æå–åˆ°è¯¥é“¾æ¥å›¾ç‰‡ç›¸å…³çš„è¯¦ç»†ä¿¡æ¯å¦‚ä¸‹ï¼š æ—¶é—´ï¼šåŠå¤œ12:27â€‹å…³è”æ ‡ç­¾ï¼š#DOU#ã€#çƒ­é—¨#ã€#ä¸²é—¨å„¿#ã€#æµé‡#â€‹å‘å¸ƒè´¦å·ï¼š@å¼ å¼ è¦åŠªåŠ›(æ¶¨ç²‰ä¸­)â€‹ç›¸å…³åŠŸèƒ½å…¥å£ï¼šé¦–é¡µã€æ¶ˆæ¯ã€æˆ‘ã€æ”¶è—ã€åˆ†äº«ã€å…³æ³¨ã€å•†åŸæ¨èã€ç‚¹å‡»æ¿€æ´»â€‹æ•°å­—ä¿¡æ¯ï¼š100ã€17ã€20ï¼ˆå…·ä½“å«ä¹‰æœªæ˜ç¡®ï¼Œæ¨æµ‹å¯èƒ½ä¸ºç‚¹èµã€æµè§ˆç›¸å…³æ•°æ®ï¼‰'''
    >>> ä»æ–‡æœ¬ä¸­æå–ç”¨æˆ·åç§°(txt2)
    'å¼ å¼ è¦åŠªåŠ›'

    >>> txt3 = '''å…³æ³¨ ğŸ€æ™“å® æœªç‚¹èµï¼Œå–œæ¬¢309ï¼ŒæŒ‰é’® 309 è¯„è®º364ï¼ŒæŒ‰é’® è¯„è®º364ï¼ŒæŒ‰é’® 364 æœªé€‰ä¸­ï¼Œæ”¶è—3ï¼ŒæŒ‰é’® 3 åˆ†äº«ï¼ŒæŒ‰é’® åˆ†äº« éŸ³ä¹ï¼Œ@ç©¿è¶Šæ—¶ç©ºåˆ›ä½œçš„åŸå£°ï¼ŒæŒ‰é’® @ğŸ€æ™“å® å¸®æˆ‘ç®—ä¸€ä¸‹å¾—ç­‰å¤šä¹…æ‰èƒ½åˆ°äº”åƒç²‰ #çœŸå®ç”Ÿæ´»åˆ†äº«å®˜ å±•å¼€ å›¾ç‰‡1ï¼ŒæŒ‰é’® æš‚åœè§†é¢‘ï¼ŒæŒ‰é’® æ ¸å¿ƒä¿¡æ¯ ç›¸å…³è®¡åˆ’ï¼šæŠ–éŸ³/æŠ–éŸ³ç²¾é€‰APPçš„åˆ›ä½œè€…ä¼™ä¼´è®¡åˆ’ï¼ŒåŠ å…¥åå‘å¸ƒä½œå“å¯æŒ‰å†…å®¹è´¨é‡ã€è·åˆ©æ’­æ”¾ã€æœ‰æ•ˆäº’åŠ¨ã€ç”¨æˆ·ä»·å€¼è®¡ç®—æ”¶ç›Šï¼ˆæ™®é€šä½œå“å¾—åŸºç¡€æ”¶ç›Šï¼Œç²¾é€‰ä½œå“å¾—åŸºç¡€+ç²¾é€‰æ”¶ç›Šï¼‰ã€‚â€‹åŠ å…¥æ¡ä»¶ï¼šæŠ–éŸ³è´¦å·äº’åŠ¨ç²‰ä¸æ•°â‰¥5000ï¼ˆå½“å‰110ï¼Œæœªæ»¡è¶³ï¼‰ã€2022å¹´èµ·å…¬å¼€ä½œå“æ•°>20ï¼ˆå½“å‰364ï¼Œå·²æ»¡è¶³ï¼‰ã€‚â€‹ç”¨æˆ·è¯‰æ±‚ï¼šå½“å‰æ¯å¤©ä»…å¢åŠ 1ä¸ªäº’åŠ¨ç²‰ä¸ï¼Œç–‘æƒ‘éœ€å¤šä¹…è¾¾åˆ°5000ç²‰ã€‚â€‹å…¶ä»–å†…å®¹ï¼šå¹³å°æä¾›ä¸“é¢˜è¯¾ç¨‹ï¼ˆæŠ–éŸ³ä¼˜è´¨è§†é¢‘åˆ›ä½œæŒ‡å—ã€æŠ–éŸ³çƒ­é—¨ç©æ³•æ•™ç¨‹åˆé›†ï¼‰ï¼Œè´¦å·æ”¶åˆ°3æ¡æ¶ˆæ¯ã€‚ éœ€è¦æˆ‘å¸®ä½ ä¼°ç®—æŒ‰å½“å‰æ¶¨ç²‰é€Ÿåº¦è¾¾æˆ5000ç²‰çš„å…·ä½“æ—¶é—´ï¼Œæˆ–æ•´ç†æ¶¨ç²‰æé€Ÿçš„å®ç”¨å»ºè®®å—ï¼Ÿ'''
    >>> ä»æ–‡æœ¬ä¸­æå–ç”¨æˆ·åç§°(txt3)
    'ğŸ€æ™“å®'

    >>> txt4 = '''å…³æ³¨ @æœ‰ä¸ªæœ‹å‹ğŸ‹ æœªç‚¹èµï¼Œå–œæ¬¢6ï¼ŒæŒ‰é’® 6 è¯„è®º3ï¼ŒæŒ‰é’® è¯„è®º3ï¼ŒæŒ‰é’® 3 æœªé€‰ä¸­ï¼Œæ”¶è—æ”¶è—ï¼ŒæŒ‰é’® æ”¶è— åˆ†äº«ï¼ŒæŒ‰é’® åˆ†äº« æ‹åŒæ¬¾ éŸ³ä¹ï¼Œ@NiNié«˜å“é‹åˆ›ä½œçš„åŸå£°ï¼ŒæŒ‰é’® @@æœ‰ä¸ªæœ‹å‹ğŸ‹ æ¥äº†ï¼Œæ¥äº†ï¼Œä¸²é—¨æ¥äº† #æŠ–éŸ³ä¼™ä¼´è®¡åˆ’æ¥äº† #åˆ›ä½œè€…æ‰¶æŒ... å±•å¼€ å›¾ç‰‡1ï¼ŒæŒ‰é’® æš‚åœè§†é¢‘ï¼ŒæŒ‰é’® æ ¸å¿ƒä¿¡æ¯ é¡µé¢åœºæ™¯ï¼šæŠ–éŸ³APPå†…ç›¸å…³åŠŸèƒ½é¡µé¢ï¼ŒåŒ…å«åˆ›ä½œæ‰¶æŒã€ä¼™ä¼´è®¡åˆ’ç­‰å†…å®¹â€‹å…³é”®æ¨¡å—ï¼šâ€‹æŠ–éŸ³ä¼™ä¼´è®¡åˆ’ï¼šåŠ å…¥æ¡ä»¶ä¸ºå¹´é¾„â‰¥18å‘¨å²ã€æŠ–éŸ³è´¦å·äº’åŠ¨ç²‰ä¸æ•°5000ï¼ˆæ˜¾ç¤ºâ€œå·²æ»¡è¶³â€â€œæœªæ»¡è¶³â€çŠ¶æ€ï¼‰â€‹åˆ›ä½œèµ„æºï¼šæŠ–éŸ³ä¼˜è´¨è§†é¢‘åˆ›ä½œæŒ‡å—ã€æŠ–éŸ³çƒ­é—¨ç©æ³•æ•™ç¨‹åˆé›†â€‹å…¶ä»–å†…å®¹ï¼šç”¨æˆ·åŠ¨æ€ï¼ˆâ€œæ¥äº†ï¼Œæ¥äº†ï¼Œæˆ‘è¦æ¥ä¸²é—¨äº†ï¼Œä»Šå¤©ç›®æ ‡300+â€ï¼‰ã€ç›¸å…³è¯é¢˜#æŠ–éŸ³ä¼™ä¼´è®¡åˆ’æ¥äº†#åˆ›ä½œè€…æ‰¶æŒ...â€‹åé¦ˆæ¸ é“ï¼šå‰å¾€ã€ŒæŠ–éŸ³app-æˆ‘-æˆ‘çš„å®¢æœã€åé¦ˆé—®é¢˜â€‹é¡µé¢åŠŸèƒ½å…¥å£ï¼šæ”¶è—ã€åˆ†äº«ã€å‘ä½œå“ã€æ‹åŒæ¬¾ï¼Œåº•éƒ¨æœ‰é¦–é¡µã€æ¶ˆæ¯ã€æˆ‘ç­‰å¯¼èˆªæ  éœ€è¦æˆ‘å¸®ä½ æ•´ç†æˆæ¸…æ™°çš„è¡¨æ ¼å½¢å¼ï¼Œæ–¹ä¾¿å¿«é€ŸæŸ¥çœ‹å…³é”®ä¿¡æ¯å—ï¼Ÿ'''
    >>> ä»æ–‡æœ¬ä¸­æå–ç”¨æˆ·åç§°(txt4)
    'æœ‰ä¸ªæœ‹å‹ğŸ‹'

    >>> txt5 = 'è¿™æ˜¯ä¸€æ®µæ²¡æœ‰æœ‰æ•ˆç”¨æˆ·åçš„æ–‡æœ¬ï¼Œåªæœ‰@å°å°é¹¿åˆ›ä½œçš„åŸå£°ï¼Œæ— ç›®æ ‡ç”¨æˆ·'
    >>> ä»æ–‡æœ¬ä¸­æå–ç”¨æˆ·åç§°(txt5) is None
    True

    # ä¸“é¡¹æµ‹è¯•ï¼šå…¨è§’æ‹¬å·å•ç‹¬åœºæ™¯
    >>> txt6 = '@æµ‹è¯•ç”¨æˆ·ï¼ˆå…¨è§’æ‹¬å·å†…å®¹ï¼‰ æµ‹è¯•æ–‡æœ¬ @æµ‹è¯•ç”¨æˆ·ï¼ˆå†æ¬¡å‡ºç°ï¼‰'
    >>> ä»æ–‡æœ¬ä¸­æå–ç”¨æˆ·åç§°(txt6)
    'æµ‹è¯•ç”¨æˆ·'

    # ä¸“é¡¹æµ‹è¯•ï¼šæ··åˆå…¨è§’/åŠè§’æ‹¬å·
    >>> txt7 = '@æ··åˆæ‹¬å·(åŠè§’)æµ‹è¯•ï¼ˆå…¨è§’ï¼‰123 @æ··åˆæ‹¬å·(åŠè§’)æµ‹è¯•ï¼ˆå…¨è§’ï¼‰456'
    >>> ä»æ–‡æœ¬ä¸­æå–ç”¨æˆ·åç§°(txt7)
    'æ··åˆæ‹¬å·æµ‹è¯•123'


    >>> txt8 = 'å…³æ³¨ å‡¯åˆ©ç«¥è½¦ æœªç‚¹èµï¼Œå–œæ¬¢159ï¼ŒæŒ‰é’® 159 è¯„è®º134ï¼ŒæŒ‰é’® è¯„è®º134ï¼ŒæŒ‰é’® 134 æœªé€‰ä¸­ï¼Œæ”¶è—1ï¼ŒæŒ‰é’® 1 åˆ†äº«ï¼ŒæŒ‰é’® åˆ†äº« éŸ³ä¹ï¼Œ@å¹¸è¿å°é”¦é²¤åˆ›ä½œçš„åŸå£°ï¼ŒæŒ‰é’® éƒ‘å·å¸‚ | å‡¯åˆ©ç«¥è½¦ @å‡¯åˆ©ç«¥è½¦ ä¸²é—¨å•¦â€¦â€¦ > æš‚åœè§†é¢‘ï¼ŒæŒ‰é’®æ—¶é—´ï¼šä¸Šåˆ7:47 ç›¸å…³è´¦å·ï¼šéƒ‘å·å¸‚|å‡¯åˆ©ç«¥è½¦ï¼ˆ@å‡¯åˆ©ç«¥è½¦ï¼‰å†…å®¹ï¼šâ€œæˆ‘æ¥ä¸²é—¨å•¦......ä»Šå¤©ä¸² 5000å®¶ã€‚â€â€‹äº’åŠ¨æ•°æ®ï¼š159æ¬¡åˆ†äº«ã€134æ¡ç›¸å…³äº’åŠ¨ï¼ˆå…·ä½“ç±»å‹æœªæ˜ç¡®ï¼‰â€‹é¡µé¢å…ƒç´ ï¼šåŒ…å«â€œé¦–é¡µâ€â€œæœ‹å‹â€â€œæ¶ˆæ¯â€â€œæˆ‘â€ç­‰å¯¼èˆªæ é€‰é¡¹ï¼Œä»¥åŠâ€œå›¢è´­ç»éªŒâ€â€œæˆéƒ½â€â€œå…³æ³¨â€â€œå•†åŸâ€â€œæ¨èâ€ç­‰æ ‡ç­¾'
    >>> ä»æ–‡æœ¬ä¸­æå–ç”¨æˆ·åç§°(txt8)
    'åµŒå¥—æ‹¬å·'

    """

    # 1. æ­£åˆ™åŒ¹é…æ‰€æœ‰@åçš„å€™é€‰ç”¨æˆ·åï¼ˆä»…æ’é™¤@/#/>/ç©ºç™½å­—ç¬¦ï¼Œä¿ç•™æ‹¬å·æ–¹ä¾¿åç»­ç»Ÿä¸€æ¸…ç†ï¼‰
    # é€‚é…å•ä¸ª@/å¤šä¸ª@ï¼ˆå¦‚@@æœ‰ä¸ªæœ‹å‹ğŸ‹ï¼‰ï¼Œ\såŒ¹é…æ‰€æœ‰ç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ç­‰ï¼‰
    candidate_pattern = r"@+([^@#> \s]+)"
    all_candidates = re.findall(candidate_pattern, txt)

    # 2. è¿‡æ»¤éŸ³ä¹åˆ›ä½œè€…ç›¸å…³çš„æ— æ•ˆå€™é€‰ï¼ˆæ’é™¤"åˆ›ä½œçš„åŸå£°"ç­‰å¹²æ‰°é¡¹ï¼‰
    filter_keywords = ["åˆ›ä½œçš„åŸå£°", "åˆ›ä½œçš„"]
    valid_candidates = [
        cand
        for cand in all_candidates
        if not any(keyword in cand for keyword in filter_keywords)
    ]

    # æ— æœ‰æ•ˆå€™é€‰æ—¶ç›´æ¥è¿”å›None
    if not valid_candidates:
        return None

    # 3. ç»Ÿè®¡å€™é€‰å‡ºç°æ¬¡æ•°ï¼Œå–å‡ºç°æœ€é¢‘ç¹çš„ï¼ˆç›®æ ‡ç”¨æˆ·ä¼šå¤šæ¬¡å‡ºç°ï¼‰
    cand_counter = Counter(valid_candidates)
    most_frequent_cand = cand_counter.most_common(1)[0][0]

    # 4. æ ¸å¿ƒï¼šæ¸…ç†æ‰€æœ‰å…¨è§’/åŠè§’æ‹¬å·åŠæ‹¬å·å†…å†…å®¹ï¼ˆé‡ç‚¹å¼ºåŒ–å…¨è§’æ‹¬å·åŒ¹é…ï¼‰
    # æ­£åˆ™è¯´æ˜ï¼š
    # [ï¼ˆ\(] â†’ åŒ¹é…å…¨è§’å·¦æ‹¬å·ï¼ˆ æˆ–åŠè§’å·¦æ‹¬å·(
    # [^ï¼‰\)]* â†’ åŒ¹é…æ‹¬å·å†…ä»»æ„å†…å®¹ï¼ˆéå…¨è§’å³æ‹¬å·ï¼‰ã€éåŠè§’å³æ‹¬å·)çš„æ‰€æœ‰å­—ç¬¦
    # [ï¼‰\)] â†’ åŒ¹é…å…¨è§’å³æ‹¬å·ï¼‰ æˆ–åŠè§’å³æ‹¬å·)
    clean_pattern = r"[ï¼ˆ\(][^ï¼‰\)]*[ï¼‰\)]"
    # å¾ªç¯æ¸…ç†ï¼šç¡®ä¿åµŒå¥—æ‹¬å·ã€å¤šæ¬¡æ‹¬å·éƒ½èƒ½è¢«å½»åº•ç§»é™¤
    clean_username = most_frequent_cand
    while re.search(clean_pattern, clean_username):
        clean_username = re.sub(clean_pattern, "", clean_username).strip()

    # æç«¯æƒ…å†µï¼šæ¸…ç†åä¸ºç©ºåˆ™è¿”å›None
    return clean_username if clean_username else None


# è¿è¡Œdoctestå•å…ƒæµ‹è¯•
if __name__ == "__main__":
    import doctest

    print(doctest.testmod(verbose=False, report=False))

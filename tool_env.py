"""
Created on 2022å¹´6æœˆ3æ—¥

@author: Administrator
"""

import platform
import re
import time

from pathlib import Path


import numpy
from numpy.lib._iotools import _is_string_like
import pandas

from tool_rect import Rect
import os
from urllib.parse import urlparse, urlunparse

import random

IPV4_PAT = "(?:[0-9]{1,3}\\.){3}[0-9]{1,3}"

OPENAI = "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"

OS_WIN = platform.system() == "Windows"

ptn_chinese = re.compile("[\u4e00-\u9fff]")

ptn_not_chinese = re.compile("[^\u4e00-\u9fff]+")

ptn_cd = re.compile("[\da-zA-Z]")

ptn_x = re.compile('\!|ï¼Ÿ|\?|"')

ptn_dot = re.compile("â€¦{2,}")

ptn_emoji = re.compile("[\U00010000-\U0010ffff]")

ptn_not_number = re.compile("[^\d^\.^\s]+")

MAIN_HOST_J_ONE = os.environ.get("MAIN_HOST_J_ONE", "https://coco.j1.sale")

U4080 = os.path.lexists("/home/yka-003/zwd")

# U4080 = True

HOST_TASK_DEFAULT = "task.j1.sale" if not U4080 else "task-test.j1.sale"

HOST_SERVER_DEFAULT = "coco.j1.sale" if not U4080 else "crawler.j1.sale"

HOST_TASK = os.environ.get("HOST_TASK", HOST_TASK_DEFAULT)

HOST_SERVER = os.getenv("HOST_SERVER", HOST_SERVER_DEFAULT)

HOST_URL = f"https://{HOST_SERVER}"

HEALTH_CARD_URL = f"{HOST_URL}/wx_msgs/healthdoc"

# HEALTH_CARD_TAG = "æ‚¨çš„å¥åº·æ¡£æ¡ˆå·²æ›´æ–°ï½"


def get_filename(file_path: str) -> str:
    """
    ä»Windowsæˆ–Linuxæ–‡ä»¶è·¯å¾„ä¸­æå–æ–‡ä»¶åï¼ˆåŒ…å«æ‰©å±•åï¼‰ï¼Œå½»åº•è§£å†³è·¨å¹³å°å…¼å®¹é—®é¢˜
    æ”¯æŒï¼šå¸¦ç›˜ç¬¦çš„Windowsè·¯å¾„ã€Linuxè·¯å¾„ã€ç½‘ç»œå…±äº«è·¯å¾„ã€æ··åˆåˆ†éš”ç¬¦è·¯å¾„

    Args:
        file_path: Windowsæˆ–Linuxæ ¼å¼çš„æ–‡ä»¶è·¯å¾„å­—ç¬¦ä¸²ï¼ˆæ™®é€šå­—ç¬¦ä¸²/åŸå§‹å­—ç¬¦ä¸²å‡å¯ï¼‰

    Returns:
        è·¯å¾„ä¸­çš„æ–‡ä»¶åï¼ˆåŒ…å«æ‰©å±•åï¼‰

    Examples:
        >>> get_filename(w_fpath)
        '1764469092.9023788.xml'
        >>> get_filename('/mnt/aaa/b.xml')  # Linuxè·¯å¾„
        'b.xml'
    """
    # 1. å¤„ç†Windowsè·¯å¾„ï¼šæ›¿æ¢åæ–œæ ä¸ºæ­£æ–œæ ï¼Œå»æ‰ç›˜ç¬¦ï¼ˆå¦‚ C:/ â†’ /ï¼‰
    # åŒ¹é… Windows ç›˜ç¬¦ï¼ˆå¦‚ C:ã€D:ï¼‰æˆ–ç½‘ç»œå…±äº«è·¯å¾„ï¼ˆ// å¼€å¤´ï¼‰
    windows_path_pattern = r"^([A-Za-z]:)?[\\/]"
    if re.match(windows_path_pattern, file_path):
        # æ›¿æ¢æ‰€æœ‰åæ–œæ ä¸ºæ­£æ–œæ 
        file_path = file_path.replace("\\", "/")
        # å»æ‰ç›˜ç¬¦ï¼ˆå¦‚ C:/ â†’ /ï¼Œä¿ç•™ç½‘ç»œå…±äº«è·¯å¾„çš„ //ï¼‰
        file_path = re.sub(r"^[A-Za-z]:/", "/", file_path)

    # 2. ç”¨ Path æå–æ–‡ä»¶åï¼ˆæ­¤æ—¶è·¯å¾„å·²ç»Ÿä¸€ä¸º / åˆ†éš”ç¬¦ï¼Œè·¨å¹³å°å…¼å®¹ï¼‰
    return Path(file_path).name


class cached_property_for_cls:
    def __init__(self, method):
        self.method = method
        self.cache = {}

    def __get__(self, instance, owner):
        if owner not in self.cache:
            self.cache[owner] = self.method(owner)
        return self.cache[owner]


def timer_decorator(func):
    def wrapper(*args, **kwargs):
        start_time = time.time()
        result = func(*args, **kwargs)
        end_time = time.time()
        print(f"{func.__name__} å‡½æ•°è¿è¡Œæ—¶é—´ï¼š{end_time - start_time} ç§’")
        return result

    return wrapper


def get_pre_of_list(i, l):
    return l[i - 1] if i > 0 else None


def get_pre_pre_of_list(i, l):
    return l[i - 2] if i > 1 else None


def split_none_numbers(line):
    """
    >>> split_none_numbers('123')
    [123]
    >>> split_none_numbers('1,23')
    [1, 23]
    >>> split_none_numbers(None)
    []
    """
    if line:
        l = filter(lambda x: x, re.split("[^\d]+", line))
        return list(map(lambda x: int(x), l))
    return []


def two_points_to_bounds(two_points):
    """
    >>> two_points_to_bounds("[45,1731][1035,1956]")
    (45, 1731, 1035, 1956)
    """
    return tuple(split_none_numbers(two_points))


def bounds_to_rect(bounds):
    """
    >>> bounds_to_rect('(0,0,4,4)')
    0 4 0 4<4, 4>
    >>> bounds_to_rect("[45,1731][1035,1956]")
    45 1035 1731 1956<990, 225>
    >>> bounds_to_rect(Rect(0,100,0,100))
    0 100 0 100<100, 100>
    >>> bounds_to_rect("{'left': 123, 'top': 704, 'right': 1032, 'bottom': 776}")
    123 1032 704 776<909, 72>
    >>> bounds_to_rect({'left': 123, 'top': 704, 'right': 1032, 'bottom': 776})
    123 1032 704 776<909, 72>
    """
    if not isinstance(bounds, Rect):
        if _is_string_like(bounds):
            if "[" in bounds:
                rect = two_points_to_bounds(bounds)
                return Rect(rect[0], rect[2], rect[1], rect[3])
            elif bounds.strip().startswith("{"):
                tmp = eval(bounds)
                return Rect(**tmp)
            else:
                rect = eval(bounds)
                return Rect(rect[0], rect[2], rect[1], rect[3])
        elif isinstance(bounds, dict):
            return Rect(**bounds)
        else:
            rect = bounds
            return Rect(rect[0], rect[2], rect[1], rect[3])
    return bounds


def bounds_to_center(bounds):
    """
    >>> bounds_to_center('(0,0,4,4)')
    (2, 2)
    >>> bounds_to_center((0,0,4,4))
    (2, 2)
    """
    rect = bounds_to_rect(bounds)
    return rect.center_x, rect.center_y


def bounds_to_shape(bounds):
    """
    >>> bounds_to_shape('(1,2,3,4)')
    (2, 2)
    >>> bounds_to_shape('(0,100,300,401)')
    (300, 301)
    """
    rect = bounds_to_rect(bounds)
    return rect.width, rect.height


def to_number_safe(line):
    try:
        return float(line)
    except ValueError:
        return numpy.nan


def to_number_with_chinese(line):
    """
    >>> to_number_with_chinese('307')
    307.0
    >>> to_number_with_chinese('4927')
    4927.0
    >>> to_number_with_chinese('2.4ä¸‡')
    24000.0
    >>> to_number_with_chinese('65.4ä¸‡')
    654000.0
    >>> to_number_with_chinese('65.4ä¸‡1')
    nan
    >>> to_number_with_chinese('65.4ä¸‡ ')
    654000.0
    >>> to_number_with_chinese('65.4')
    65.4
    >>> to_number_with_chinese(None)
    nan
    """
    if not line:
        return numpy.nan
    l = line.strip().rsplit("ä¸‡", 1)

    length = len(l)
    if length == 2 and not l[1]:
        u = 10000
    elif length == 1:
        u = 1
    else:
        u = numpy.nan

    return to_number_safe(l[0]) * u


def to_number_with_chinese_safe(line):
    v = to_number_with_chinese(line)
    return v if not numpy.isnan(v) else line


def to_number_with_chinese_safe_dict(d):
    return {k: to_number_with_chinese_safe(v) for k, v in d.items()}


def is_ipv4(host):
    return re.match(IPV4_PAT, host) is not None


def clear_emoji(content):
    return ptn_emoji.sub("", content)


def smart_range(start, end):
    """
    >>> list(smart_range(0,10))
    [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
    >>> list(smart_range(10,1))
    [10, 9, 8, 7, 6, 5, 4, 3, 2, 1]
    >>> list(smart_range(*('1-3'.split('-'))))
    [1, 2, 3]
    >>> list(smart_range(0,0))
    [0]
    >>> list(smart_range(1,1))
    [0]
    """
    end = int(end)
    start = int(start)
    if end == start:
        return range(0, 1)
    s = numpy.sign(end - start)
    return range(start, end + s, s)


def float_range(start, stop, step=1.0):
    """
    >>> list(float_range(1,4.0,0.5))
    [1, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0]
    >>> list(float_range(1,4.1,0.5))
    [1, 1.5, 2.0, 2.5, 3.0, 3.5, 4.1]
    >>> list(float_range(1,4.4,0.5))
    [1, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.4]
    >>> list(float_range(1,1.1,0.5))
    [1, 1.1]
    """
    current = start
    while 1:
        yield current
        current += step
        if numpy.isclose(current, stop, atol=step / 2):
            yield stop
            break
        if current >= stop:
            yield stop
            break


def smart_range_safe(start, end):
    try:
        return smart_range(start, end)
    except:
        pass
    return []


def is_string(x):
    return _is_string_like(x)


def to_float(x):
    try:
        return float(x)
    except Exception:
        pass


def is_float(x):
    """
    >>> is_float(None)
    False
    >>> is_float(0)
    False
    >>> is_float(1.0)
    True
    >>> is_float('.11')
    True
    >>> is_float('.11.')
    False
    >>> is_float('0')
    False
    >>> is_float('0.1')
    True
    """
    return isinstance(x, float) or (
        isinstance(x, str) and "." in x and to_float(x) is not None
    )


def is_int(x):
    return to_int(x) is not None


def is_number(x):
    return is_int(x)


def to_int(x, default=None):
    """
    >>> to_int('1.0') == 1
    True
    >>> to_int('1') == 1
    True
    >>> to_int('1.1a')
    """
    try:
        return int(x)
    except Exception:
        pass
    try:
        return int(float(x))
    except Exception:
        pass
    return default


def is_chinese(ch):
    return "\u4e00" <= ch <= "\u9fff"


def replace_stupid(s):
    """
    >>> replace_stupid('ç‰¹æ–¯æ‹‰å®¢æœå›åº”Model 3ã€Model Yé™ä»·ï¼šå·²ä¸‹å•æœªæè½¦å¯é€‰å®˜ç½‘ä»·')
    'ç‰¹æ–¯æ‹‰å®¢fuæœå›åº”Model 3ã€Model Yé™ä»·ï¼šå·²ä¸‹å•æœªæè½¦å¯é€‰å®˜ç½‘ä»·'
    >>> replace_stupid('é©¬æ–¯å…‹æ‰“é€ æµ·å¤–ç‰ˆå¾®ä¿¡ï¼ŒFacebookæœ€å—ä¼¤')
    'é©¬æ–¯å…‹æ‰“é€ æµ·å¤–ç‰ˆå¾®xä¿¡ï¼ŒFacebookæœ€å—ä¼¤'
    """
    s = (
        s.replace("å®¢æœ", "å®¢fuæœ")
        .replace("å¾®ä¿¡", "å¾®xä¿¡")
        .replace("åŠ å…¥", "å¤¹å…¥")
        .replace("Keychron", "å‡¯å…‹é¾™")
    )
    s = s.replace("mPower", "")
    s = s.replace("äº¤æµ", "äº¤xæµ")
    return s


def replace_special(s):
    """
    >>> replace_special('c++')
    'cï¼‹+'
    >>> replace_special('å°åº¦æ”¿åºœè¿™æ‰‹ï¼Œä¸‰æ˜Ÿã€è‹¹æœå’Œä¸­å›½å‚å®¶éƒ½éƒé—·äº†â€¦â€¦?')
    'å°åº¦æ”¿åºœè¿™æ‰‹ï¼Œä¸‰æ˜Ÿã€è‹¹æœå’Œä¸­å›½å‚å®¶éƒ½éƒé—·äº†â€¦?'
    >>> replace_special('iPhone.6æ­£å¼â€œé€€ä¼‘â€ï¼Œå…¶ç³»åˆ—å–å‡º25äº¿éƒ¨ï¼ŒäºŒæ‰‹æ”¶è´­ä»·ç°å·²ä½è‡³ç™¾å…ƒ....')
    'iPhone.6æ­£å¼â€œé€€ä¼‘â€ï¼Œå…¶ç³»åˆ—å–å‡º25äº¿éƒ¨ï¼ŒäºŒæ‰‹æ”¶è´­ä»·ç°å·²ä½è‡³ç™¾å…ƒ'
    """
    s = s.replace("++", "ï¼‹+")
    s = ptn_dot.sub("â€¦", s)
    s = re.compile("\.+$").sub("", s)
    return s


def is_special(x):
    """
    >>> is_special('ã€')
    True
    >>> is_special('z')
    False
    >>> is_special(';')
    True
    >>> is_special('.')
    True
    >>> is_special('äºº')
    False
    >>> is_special('!')
    False
    >>> is_special('ï¼Ÿ')
    False
    >>> is_special('ï¼Ÿ')
    False
    >>> is_special('"')
    False
    >>> is_special('Ã¤')
    True
    >>> is_special('ã€Œ')
    True
    >>> is_special('ï¼Ÿ')
    False
    >>> is_special('ï¼š')
    True
    >>> is_special(chr(128076))
    True
    """
    if is_chinese(x):
        return False
    if ptn_cd.match(x) is not None:
        return False

    if ptn_x.match(x) is not None:
        return False
    return True


def insert_d_if_starts_with_special(s):
    """
    >>> insert_d_if_starts_with_special('ã€Œæœ€ç‰›AIè‰ºæœ¯å®¶ã€Stable Diffusionæœ‰å¤šå€¼é’±ï¼Ÿç§å­è½®èèµ„å³æ™‹å‡ç‹¬è§’')
    'dã€Œæœ€ç‰›AIè‰ºæœ¯å®¶ã€Stable Diffusionæœ‰å¤šå€¼é’±ï¼Ÿç§å­è½®èèµ„å³æ™‹å‡ç‹¬è§’'
    """
    if s and is_special(s[0]):
        return "d" + s
    return s


def append_qustion_mark_if_end_with_special(s):
    """
    >>> append_qustion_mark_if_end_with_special('å›½é™…è±¡æ£‹æ¯”èµ›èµ°ã€Œåã€é—¨ï¼Ÿè°æƒ³å‡ºæ¥çš„ã€Œæ™ºèƒ½è‚›ç ã€')
    'å›½é™…è±¡æ£‹æ¯”èµ›èµ°ã€Œåã€é—¨ï¼Ÿè°æƒ³å‡ºæ¥çš„ã€Œæ™ºèƒ½è‚›ç ã€?'
    >>> append_qustion_mark_if_end_with_special('InfoQ 2022 å¹´è¶‹åŠ¿æŠ¥å‘Šï¼š')
    'InfoQ 2022 å¹´è¶‹åŠ¿æŠ¥å‘Šï¼š?'
    """
    if is_special(s[-1]):
        return s + "?"
    return s


def insert_double_qoute_if_start_with_special(s):
    """
    >>> insert_double_qoute_if_start_with_special('ã€ŒAIä¸–ç•Œã€è¿˜ç¼ºç‚¹å•¥ï¼Ÿç‰›æ´¥å¤§å­¦æ•™æˆï¼šç°å®ä¸–ç•Œ')
    '"ã€ŒAIä¸–ç•Œã€è¿˜ç¼ºç‚¹å•¥ï¼Ÿç‰›æ´¥å¤§å­¦æ•™æˆï¼šç°å®ä¸–ç•Œ'
    """
    if is_special(s[0]):
        return '"' + s
    return s


def replace_double_special_to_single(s):
    """
    >>> replace_double_special_to_single('å¤äººç±»DNAä¸é‡ç—‡æ–°å† æœ‰å…³ï¼Ÿ2022è¯ºå¥–å¾—ä¸»PÃ¤Ã¤boï¼Œç«Ÿæ˜¯å‰è¯ºå¥–å¾—ä¸»ç§ç”Ÿå­')
    'å¤äººç±»DNAä¸é‡ç—‡æ–°å† æœ‰å…³ï¼Ÿ2022è¯ºå¥–å¾—ä¸»PÃ¤boï¼Œç«Ÿæ˜¯å‰è¯ºå¥–å¾—ä¸»ç§ç”Ÿå­'
    >>> replace_double_special_to_single('Metaè¢«æ›æ­£æ‚„æ‚„è£å‘˜ï¼Œæˆ–æ³¢åŠ1.2ä¸‡åå‘˜å·¥')
    'Metaè¢«æ›æ­£æ‚„æ‚„è£å‘˜ï¼Œæˆ–æ³¢åŠ1.2ä¸‡åå‘˜å·¥'
    >>> replace_double_special_to_single('ç£å¸¦éä½†æ²¡è¢«æ·˜æ±°ï¼Œå®¹é‡è¿˜æ¯”ç¡¬ç›˜å¤§äº†ï¼Ÿï¼Ÿï¼Ÿ')
    'ç£å¸¦éä½†æ²¡è¢«æ·˜æ±°ï¼Œå®¹é‡è¿˜æ¯”ç¡¬ç›˜å¤§äº†ï¼Ÿ'
    """
    l = set(filter(lambda x: is_special(x), s))
    l.add("ï¼Ÿ")
    for x in l:
        s = re.compile("%s+" % re.escape(x)).sub(x, s)
    return s


def has_chinese(line):
    if line:
        for ch in line:
            if is_chinese(ch):
                return True
    return False


def split_df(df, batch_size=1000):
    for x in range(0, len(df), batch_size):
        yield df.iloc[x : x + batch_size]


def pct_chinese(line):
    """
    >>> pct_chinese('') == 0
    True
    >>> pct_chinese(None) == 0
    True
    >>> pct_chinese('1') == 0
    True
    >>> pct_chinese('1äºº') == 50
    True
    >>> pct_chinese('äººå®¶') == 100
    True
    """
    if line and len(line) > 0:
        tmp = ptn_chinese.sub("", line)
        return int((1 - len(tmp) / len(line)) * 100)
    return 0


def density_chinese(line):
    """
    >>> density_chinese('') == 0
    True
    >>> density_chinese(None) == 0
    True
    >>> density_chinese('1') == 0
    True
    >>> density_chinese('1äºº')
    0.5
    >>> density_chinese('äººå®¶')
    1.0
    """
    if line and len(line) > 0:
        return len(remain_chinese(line)) / len(line)
    return 0


def clear_chinese(line):
    """
    >>> clear_chinese('äººå®¶')  == ''
    True
    >>> len(clear_chinese(mulline_text)) == 8
    True
    """
    return ptn_chinese.sub("", line)


def remain_chinese(line):
    """
    >>> remain_chinese('äººå®¶12')  == 'äººå®¶'
    True
    >>> remain_chinese(mulline_text) == 'äººå®¶ç£å¸¦éä½†æ²¡è¢«æ·˜æ±°å®¹é‡è¿˜æ¯”ç¡¬ç›˜å¤§äº†'
    True
    """
    return ptn_not_chinese.sub("", line)


def split_by_not_chinese(line):
    """
    >>> split_by_not_chinese('äºº11222333å¤§')
    ['äºº', 'å¤§']
    >>> split_by_not_chinese('äºº11222333å¤§kk')
    ['äºº', 'å¤§']
    >>> split_by_not_chinese(None)
    []
    """
    return list(filter(lambda x: x, ptn_not_chinese.split(line))) if line else []


def simple_encode(line, v=122):
    """
    >>> simple_encode(simple_encode('h123')) == 'h123'
    True
    >>> simple_encode(simple_encode('http://www.baidu.com:8090/')) == 'http://www.baidu.com:8090/'
    True
    """
    l = list(line)
    return "".join(map(lambda x: chr(ord(x) ^ v), l))


def first_or_last(list_like, i, default=None):
    if hasattr(list_like, "__next__"):
        try:
            return list(list_like)[i]
        except IndexError:
            return
    if isinstance(list_like, pandas.DataFrame):
        return default if list_like.empty else list_like.iloc[i]
    if list_like is not None and len(list_like) > 0:
        return list(list_like)[i]
    return default


def first(list_like, default=None):
    """
    >>> first([])
    >>> first(None)
    >>> first(None, 'test') == 'test'
    True
    >>> first([3,2,1]) == 3
    True
    >>> first(empty_s)
    >>> first(demo_s) == 1
    True
    >>> first(empty_df)
    >>> first(demo_df).x
    1
    >>> first(range(10))
    0
    >>> first(filter(lambda x:x, range(1,10)))
    1
    """
    return first_or_last(list_like, 0, default)


def last(list_like, default=None):
    """
    >>> last([])
    >>> last(None)
    >>> last(None, 'test') == 'test'
    True
    >>> last([3,2,1]) == 1
    True
    >>> last(empty_s)
    >>> last(demo_s) == 2
    True
    >>> last(empty_df)
    >>> last(demo_df).x
    2
    >>> last(range(10))
    9
    >>> last(filter(lambda x:x, range(1,100)))
    99
    """
    return first_or_last(list_like, -1, default)


def æ ¼å¼åŒ–è¿è¡Œå‚æ•°(txt):
    """
    >>> æ ¼å¼åŒ–è¿è¡Œå‚æ•°('aa bb')
    {'aa': 'bb'}
    >>> æ ¼å¼åŒ–è¿è¡Œå‚æ•°(s1)
    {'aa': 'bb', 'cc': 'dd ee'}
    >>> æ ¼å¼åŒ–è¿è¡Œå‚æ•°(mulline_text)
    {}
    >>> æ ¼å¼åŒ–è¿è¡Œå‚æ•°(mulline_text1)
    {'äººå®¶': '1213', 'ç£å¸¦éä½†æ²¡è¢«æ·˜æ±°': 'å®¹é‡è¿˜æ¯”ç¡¬ç›˜å¤§äº†123'}
    >>> æ ¼å¼åŒ–è¿è¡Œå‚æ•°('')
    {}
    >>> æ ¼å¼åŒ–è¿è¡Œå‚æ•°(None)
    {}
    >>> æ ¼å¼åŒ–è¿è¡Œå‚æ•°(' ')
    {}
    """
    if txt:
        l = map(lambda x: x.strip(), txt.splitlines())
        l = filter(lambda x: x, l)
        l = map(lambda x: x.split(" ", maxsplit=1), l)
        l = filter(lambda x: len(x) == 2, l)
        return dict(l)
    return {}


def ç»„è£…å‚æ•°(txt):
    è¿è¡Œå‚æ•° = æ ¼å¼åŒ–è¿è¡Œå‚æ•°(txt)
    if not è¿è¡Œå‚æ•° and txt and txt.strip():
        è¿è¡Œå‚æ•° = {"è¿è¡Œå‚æ•°": txt.strip()}
    return è¿è¡Œå‚æ•°


def æŠ½ç¦»æ•°å­—(txt):
    """
    >>> æŠ½ç¦»æ•°å­—('124$')
    '124'
    >>> æŠ½ç¦»æ•°å­—('Â¥152 ')
    '152'
    >>> æŠ½ç¦»æ•°å­—('Â¥152 .32')
    '152 .32'
    """
    return ptn_not_number.sub("", txt).strip() if txt else None


def æ–‡å­—æˆªæ–­(txt, æœ€å¤§é•¿åº¦=20, æˆªæ–­æ›¿ä»£="..."):
    """
    >>> æ–‡å­—æˆªæ–­('aaa')
    'aaa'
    >>> æ–‡å­—æˆªæ–­('123456', 6)
    '123456'
    >>> æ–‡å­—æˆªæ–­('1234567', 6)
    '123456...'
    """
    return f"""{txt[:æœ€å¤§é•¿åº¦]}{'' if len(txt[æœ€å¤§é•¿åº¦:]) == 0 else æˆªæ–­æ›¿ä»£}"""


def remove_leading_whitespace(text):
    pattern = r"^[ \t]+"
    return re.sub(pattern, "", text, flags=re.M)


def replace_url_host(url, host_name):
    """
    æ›¿æ¢URLä¸­çš„ä¸»æœºåéƒ¨åˆ†ï¼Œæ”¯æŒè·¯å¾„å½¢å¼URLå’Œé»˜è®¤httpsåè®®

    å‚æ•°:
        url (str): åŸå§‹URL
        host_name (str): æ–°çš„ä¸»æœºå

    è¿”å›:
        str: æ›¿æ¢ä¸»æœºååçš„æ–°URL

    ç¤ºä¾‹:
        >>> replace_url_host("https://crawler.j1.sale/admin/wx_msgs/", "coco.test.com")
        'https://coco.test.com/admin/wx_msgs/'

        >>> replace_url_host("http://oldhost/path", "newhost")
        'http://newhost/path'

        >>> replace_url_host("ftp://user:pass@oldhost:21/dir", "newhost")
        'ftp://newhost/dir'

        >>> replace_url_host("https://oldhost:8080", "newhost:9090")
        'https://newhost:9090'

        >>> replace_url_host("http://oldhost", "newhost")
        'http://newhost'

        >>> replace_url_host("/aaa/bbb", "coco.test.com")
        'https://coco.test.com/aaa/bbb'

        >>> replace_url_host("aaa/bbb", "coco.test.com")
        'https://coco.test.com/aaa/bbb'

        >>> replace_url_host("//oldhost/path", "newhost")
        'https://newhost/path'

        >>> replace_url_host("", "newhost")
        'https://newhost'
    """
    # è§£æURLï¼Œè·å–å„ä¸ªç»„æˆéƒ¨åˆ†
    parsed_url = urlparse(url)

    # å¤„ç†åè®®ï¼šå¦‚æœåŸURLæ²¡æœ‰åè®®ï¼Œé»˜è®¤ä½¿ç”¨https
    scheme = parsed_url.scheme if parsed_url.scheme else "https"

    # æ›¿æ¢ä¸»æœºåï¼ˆæ— è®ºåŸURLæ˜¯å¦æœ‰ä¸»æœºåï¼‰
    new_netloc = host_name

    # é‡æ–°ç»„åˆURLçš„å„ä¸ªéƒ¨åˆ†ï¼ˆä½¿ç”¨å¤„ç†åçš„åè®®å’Œæ–°ä¸»æœºåï¼‰
    new_components = (
        scheme,
        new_netloc,
        parsed_url.path,
        parsed_url.params,
        parsed_url.query,
        parsed_url.fragment,
    )

    new_url = urlunparse(new_components)
    return new_url


def ç²¾ç¡®è¯†åˆ«å¹¶æˆªæ–­åºŸè¯(txt: str) -> str:
    """
    ç²¾ç¡®è¯†åˆ«å¹¶æˆªæ–­æ–‡æœ¬ä¸­åŒ…å«"èŠèŠ"çš„åºŸè¯éƒ¨åˆ†ï¼Œè¿”å›æ ¸å¿ƒå†…å®¹

    åŠŸèƒ½è¯´æ˜ï¼š
    - å…ˆæ¸…ç†æ–‡æœ¬é¦–å°¾çš„ç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç­‰ï¼‰
    - å®šä½"èŠèŠ"çš„èµ·å§‹ä½ç½®ï¼Œè‹¥æ— åˆ™è¿”å›æ¸…ç†åçš„åŸæ–‡æœ¬
    - æ‰¾åˆ°"èŠèŠ"åï¼Œå‘åè·³è¿‡é€—å·ï¼Œå¯»æ‰¾ç¬¬ä¸€ä¸ªéé€—å·æˆªæ–­æ ‡ç‚¹ï¼ˆã€‚ï¼ï½ï¼‰
    - æˆªæ–­åˆ°è¯¥æ ‡ç‚¹å‰çš„æ ¸å¿ƒå†…å®¹

    >>> ç²¾ç¡®è¯†åˆ«å¹¶æˆªæ–­åºŸè¯("ä»è§†é¢‘é‡Œèƒ½æ„Ÿå—åˆ°æ‰‹å·¥ç¼–ç»³çš„ç”¨å¿ƒï¼Œè²”è²…å’Œåé‡‘å…½çš„æ­é…å¾ˆæœ‰ç‰¹è‰²ï¼Œè‰²å½©ä¸°å¯Œä¹Ÿæ˜¾å¾—å¾ˆæœ‰æ´»åŠ›å‘¢ï¼è¦æ˜¯ä½ åœ¨ç¼–ç»³é…è‰²æˆ–æŠ€å·§ä¸Šæœ‰æƒ³äº¤æµçš„ï¼Œå’±ä»¬å¯ä»¥ä¸€èµ·èŠèŠå‘€ã€‚")
    'ä»è§†é¢‘é‡Œèƒ½æ„Ÿå—åˆ°æ‰‹å·¥ç¼–ç»³çš„ç”¨å¿ƒï¼Œè²”è²…å’Œåé‡‘å…½çš„æ­é…å¾ˆæœ‰ç‰¹è‰²ï¼Œè‰²å½©ä¸°å¯Œä¹Ÿæ˜¾å¾—å¾ˆæœ‰æ´»åŠ›å‘¢ï¼'
    >>> ç²¾ç¡®è¯†åˆ«å¹¶æˆªæ–­åºŸè¯("ä»è§†é¢‘é‡Œèƒ½æ„Ÿå—åˆ°æ¼”å”±ä¼šå¸¦æ¥çš„çƒ­çƒˆæ°›å›´å’Œä¹‹åçš„ä¸èˆæ„Ÿï¼Œè¿™ç§æˆ’æ–­ååº”ç‰¹åˆ«èƒ½è®©äººå…±æƒ…å‘¢ï¼è¦æ˜¯è¿˜æƒ³å›å‘³ç°åœºï¼Œå’Œæˆ‘èŠèŠå°è±¡æœ€æ·±çš„ç‰‡æ®µä¹Ÿå¾ˆå¼€å¿ƒå‘€ã€‚	")
    'ä»è§†é¢‘é‡Œèƒ½æ„Ÿå—åˆ°æ¼”å”±ä¼šå¸¦æ¥çš„çƒ­çƒˆæ°›å›´å’Œä¹‹åçš„ä¸èˆæ„Ÿï¼Œè¿™ç§æˆ’æ–­ååº”ç‰¹åˆ«èƒ½è®©äººå…±æƒ…å‘¢ï¼'
    >>> ç²¾ç¡®è¯†åˆ«å¹¶æˆªæ–­åºŸè¯("ä»è§†é¢‘é‡Œèƒ½æ„Ÿå—åˆ°æ‰‹å·¥åˆ›ä½œçš„æ¸©æŸ”æ„Ÿï¼Œâ€œç”Ÿæ´»è¯¥æ˜¯è¢«çƒ­çˆ±çš„äººäº‹å¡«æ»¡â€è¿™å¥è¯ç‰¹åˆ«æˆ³äººï¼Œè¿™æ ·çš„æ‰‹å·¥å†…å®¹æ—¢æ²»æ„ˆåˆèƒ½ä¼ é€’å¯¹ç”Ÿæ´»çš„çƒ­çˆ±ï½è¦æ˜¯ä½ æƒ³äº†è§£è§†é¢‘é‡Œæ‰‹å·¥åˆ¶ä½œçš„å…·ä½“æŠ€å·§ï¼Œæˆ–è€…æƒ³èŠèŠè¿™ç±»æ‰‹å·¥çš„åˆ›ä½œçµæ„Ÿï¼Œéƒ½å¯ä»¥è·Ÿæˆ‘è¯´å‘€ï½")
    'ä»è§†é¢‘é‡Œèƒ½æ„Ÿå—åˆ°æ‰‹å·¥åˆ›ä½œçš„æ¸©æŸ”æ„Ÿï¼Œâ€œç”Ÿæ´»è¯¥æ˜¯è¢«çƒ­çˆ±çš„äººäº‹å¡«æ»¡â€è¿™å¥è¯ç‰¹åˆ«æˆ³äººï¼Œè¿™æ ·çš„æ‰‹å·¥å†…å®¹æ—¢æ²»æ„ˆåˆèƒ½ä¼ é€’å¯¹ç”Ÿæ´»çš„çƒ­çˆ±ï½'
    >>> ç²¾ç¡®è¯†åˆ«å¹¶æˆªæ–­åºŸè¯("ä»è§†é¢‘é‡Œèƒ½æ„Ÿå—åˆ°ä½ ç”¨ç¼çº«æœºåˆ›ä½œæ—¶çš„é¡ºç•…æ„Ÿï¼Œçœ‹æ¥é‡æœº90è¿™æ¬¾ç¼çº«æœºç¡®å®å¾ˆé€‚é…ä½ çš„ç¼çº«éœ€æ±‚ï¼Œæ­é…ä¸Šä½ çš„å¤©èµ‹ï¼Œåšæ‰‹å·¥è‚¯å®šç‰¹åˆ«æœ‰æˆå°±æ„Ÿï½")
    'ä»è§†é¢‘é‡Œèƒ½æ„Ÿå—åˆ°ä½ ç”¨ç¼çº«æœºåˆ›ä½œæ—¶çš„é¡ºç•…æ„Ÿï¼Œçœ‹æ¥é‡æœº90è¿™æ¬¾ç¼çº«æœºç¡®å®å¾ˆé€‚é…ä½ çš„ç¼çº«éœ€æ±‚ï¼Œæ­é…ä¸Šä½ çš„å¤©èµ‹ï¼Œåšæ‰‹å·¥è‚¯å®šç‰¹åˆ«æœ‰æˆå°±æ„Ÿï½'
    >>> ç²¾ç¡®è¯†åˆ«å¹¶æˆªæ–­åºŸè¯("èƒ½æ„Ÿå—åˆ°ä½ åœ¨æ²¡æœ‰æ›´æ–°çš„æ—¥å­é‡Œï¼Œä¹Ÿåœ¨ç”¨å¿ƒé€šè¿‡ç¼çº«æœºä¸“æ³¨åˆ›ä½œï¼Œè¿™ä»½å¯¹æ‰‹å·¥çš„åšæŒç‰¹åˆ«æ‰“åŠ¨äººã€‚")
    'èƒ½æ„Ÿå—åˆ°ä½ åœ¨æ²¡æœ‰æ›´æ–°çš„æ—¥å­é‡Œï¼Œä¹Ÿåœ¨ç”¨å¿ƒé€šè¿‡ç¼çº«æœºä¸“æ³¨åˆ›ä½œï¼Œè¿™ä»½å¯¹æ‰‹å·¥çš„åšæŒç‰¹åˆ«æ‰“åŠ¨äººã€‚'
    >>> ç²¾ç¡®è¯†åˆ«å¹¶æˆªæ–­åºŸè¯("çœ‹åˆ°è§†é¢‘é‡Œçš„è‰è“ç»’èŠ±ï¼Œè§‰å¾—ç‰¹åˆ«æœ‰å†¬æ—¥æ°›å›´ï¼Œç»’èŠ±çš„è´¨æ„ŸæŸ”è½¯åˆç²¾è‡´ï¼Œåšæˆå‘ç°ªæˆ´åœ¨å¤´ä¸Šè‚¯å®šå¾ˆäº®çœ¼ï¼Œè¿˜èƒ½æ„Ÿå—åˆ°éé—æ‰‹è‰ºçš„ç‹¬ç‰¹é­…åŠ›ã€‚")
    'çœ‹åˆ°è§†é¢‘é‡Œçš„è‰è“ç»’èŠ±ï¼Œè§‰å¾—ç‰¹åˆ«æœ‰å†¬æ—¥æ°›å›´ï¼Œç»’èŠ±çš„è´¨æ„ŸæŸ”è½¯åˆç²¾è‡´ï¼Œåšæˆå‘ç°ªæˆ´åœ¨å¤´ä¸Šè‚¯å®šå¾ˆäº®çœ¼ï¼Œè¿˜èƒ½æ„Ÿå—åˆ°éé—æ‰‹è‰ºçš„ç‹¬ç‰¹é­…åŠ›ã€‚'
    >>> ç²¾ç¡®è¯†åˆ«å¹¶æˆªæ–­åºŸè¯("å“ˆå“ˆï¼Œæ„Ÿè§‰è¿™ç§â€œä½ å–å…³æˆ‘ä¹Ÿå–å…³â€çš„æƒ³æ³•è¿˜æŒºçœŸå®çš„ï¼æ¯•ç«ŸåŒå‘çš„å…³æ³¨æ‰æœ‰æ„ä¹‰å˜›ï½æˆ‘ä¹‹å‰ä¹Ÿé‡åˆ°è¿‡è¢«å–å…³æ²¡å‘ç°çš„æƒ…å†µï¼Œä½ å¹³æ—¶ä¼šç‰¹æ„å»çœ‹è°å–å…³è‡ªå·±å—ï½	")
    'å“ˆå“ˆï¼Œæ„Ÿè§‰è¿™ç§â€œä½ å–å…³æˆ‘ä¹Ÿå–å…³â€çš„æƒ³æ³•è¿˜æŒºçœŸå®çš„ï¼æ¯•ç«ŸåŒå‘çš„å…³æ³¨æ‰æœ‰æ„ä¹‰å˜›ï½'
    >>> ç²¾ç¡®è¯†åˆ«å¹¶æˆªæ–­åºŸè¯("æ™šä¸Šå¥½å‘€ï½ æ¯å¤©æ”¶åˆ°ä½ çš„é—®å€™éƒ½è¶…å¼€å¿ƒï¼æ¯”å¿ƒå›èµ ï¼Œæ„¿ä½ ä¹Ÿè¢«æ¸©æŸ”å’Œå¥½è¿åŒ…å›´ï¼Œå…ƒæ°”æ»¡æ»¡ä¸€æ•´å¤©å‘€ï½")
    'æ™šä¸Šå¥½å‘€ï½ æ¯å¤©æ”¶åˆ°ä½ çš„é—®å€™éƒ½è¶…å¼€å¿ƒï¼æ¯”å¿ƒå›èµ ï¼Œæ„¿ä½ ä¹Ÿè¢«æ¸©æŸ”å’Œå¥½è¿åŒ…å›´ï¼Œå…ƒæ°”æ»¡æ»¡ä¸€æ•´å¤©å‘€ï½'
    """
    # ç¬¬ä¸€æ­¥ï¼šæ¸…ç†æ–‡æœ¬é¦–å°¾çš„ç©ºç™½å­—ç¬¦
    cleaned_txt = txt.strip()

    # ç¬¬äºŒæ­¥ï¼šå®šä½"èŠèŠ"çš„èµ·å§‹ä½ç½®ï¼ˆæ‰¾ä¸åˆ°è¿”å›-1ï¼‰
    words = ["èŠèŠ", "å—ï½"]
    chat_pos = -1
    for x in words:
        chat_pos = cleaned_txt.find(x)
        if chat_pos != -1:
            break
    # chat_pos = cleaned_txt.find("èŠèŠ")

    if chat_pos == -1:
        # æ— "èŠèŠ"ï¼Œè¿”å›æ¸…ç†åçš„åŸæ–‡æœ¬
        return cleaned_txt
    else:
        cleaned_txt = cleaned_txt[:chat_pos]
    return æŸ¥æ‰¾å¹¶æˆªæ–­(cleaned_txt)


def is_endswith_question(text: str) -> bool:
    question_end_pattern = r"[?ï¼Ÿ]\s*$"
    return re.search(question_end_pattern, text)


def is_contains_question(text: str) -> bool:
    question_pattern = r"[?ï¼Ÿ]"
    return re.search(question_pattern, text)


def æŸ¥æ‰¾å¹¶æˆªæ–­(
    text: str, target_puncts: str = "ï½~ã€‚ï¼Ÿï¼?!", is_question_search_mode=False
):
    """
    æˆªæ–­æ–‡æœ¬ï¼Œè¿”å›æˆªæ–­åçš„æ–‡æœ¬ã€‚

    å‚æ•°ï¼š
    - text: å¾…æˆªæ–­çš„æ–‡æœ¬
    - target_puncts: æˆªæ–­çš„æ ‡ç‚¹åˆ—è¡¨ï¼Œé»˜è®¤ä¸º"ï½~ã€‚ï¼Ÿï¼?!", è¡¨ç¤ºæˆªæ–­åˆ°æœ€åä¸€ä¸ª"ï½~ã€‚ï¼Ÿï¼?!",
    - is_question_search_mode: æ˜¯å¦ä»¥é—®å·ç»“å°¾çš„æœç´¢æ¨¡å¼ï¼Œé»˜è®¤ä¸ºFalse
    >>> æŸ¥æ‰¾å¹¶æˆªæ–­("è§†é¢‘é‡Œâ€œåˆåˆ·åˆ°æˆ‘äº†å§ï¼Ÿè¿™å°±æ˜¯å‘½ï¼Œä½ èº²éƒ½èº²ä¸æ‰â€è¿™å¥è¯ç‰¹åˆ«æœ‰æ¢—ï¼Œå¸¦ç€ç‚¹å°ä¿çš®çš„è°ƒä¾ƒæ„Ÿï¼Œåƒæœ‹å‹é—´çš„è½»æ¾äº’åŠ¨ï¼Œè®©äººçœ‹äº†å¿ä¸ä½ä¼šå¿ƒä¸€ç¬‘ï¼Œå¾ˆæœ‰æ—¥å¸¸æ‰“å‘æ—¶é—´çš„æ¬¢ä¹æ°›å›´ï½ä¸çŸ¥é“ä½ æ˜¯è§‰å¾—è¿™å¥æ–‡æ¡ˆå¾ˆæœ‰è¶£ï¼Œè¿˜æ˜¯ä¹Ÿå–œæ¬¢è¿™ç§è½»æ¾å¥½ç©çš„å¯¹å£å‹è§†é¢‘é£æ ¼å‘€ï¼Ÿ	", "ï¼Ÿ?", is_question_search_mode=True)
    'è§†é¢‘é‡Œâ€œåˆåˆ·åˆ°æˆ‘äº†å§ï¼Ÿè¿™å°±æ˜¯å‘½ï¼Œä½ èº²éƒ½èº²ä¸æ‰â€è¿™å¥è¯ç‰¹åˆ«æœ‰æ¢—ï¼Œå¸¦ç€ç‚¹å°ä¿çš®çš„è°ƒä¾ƒæ„Ÿï¼Œåƒæœ‹å‹é—´çš„è½»æ¾äº’åŠ¨ï¼Œè®©äººçœ‹äº†å¿ä¸ä½ä¼šå¿ƒä¸€ç¬‘ï¼Œå¾ˆæœ‰æ—¥å¸¸æ‰“å‘æ—¶é—´çš„æ¬¢ä¹æ°›å›´ï½ä¸çŸ¥é“ä½ æ˜¯è§‰å¾—è¿™å¥æ–‡æ¡ˆå¾ˆæœ‰è¶£ï¼Œè¿˜æ˜¯ä¹Ÿå–œæ¬¢è¿™ç§è½»æ¾å¥½ç©çš„å¯¹å£å‹è§†é¢‘é£æ ¼å‘€ï¼Ÿ'
    >>> æŸ¥æ‰¾å¹¶æˆªæ–­("è§†é¢‘é‡Œâ€œåˆåˆ·åˆ°æˆ‘äº†å§ï¼Ÿè¿™å°±æ˜¯å‘½ï¼Œä½ èº²éƒ½èº²ä¸æ‰â€è¿™å¥è¯ç‰¹åˆ«æœ‰æ¢—ï¼Œå¸¦ç€ç‚¹å°ä¿çš®çš„è°ƒä¾ƒæ„Ÿï¼Œåƒæœ‹å‹é—´çš„è½»æ¾äº’åŠ¨ï¼Œè®©äººçœ‹äº†å¿ä¸ä½ä¼šå¿ƒä¸€ç¬‘ï¼Œå¾ˆæœ‰æ—¥å¸¸æ‰“å‘æ—¶é—´çš„æ¬¢ä¹æ°›å›´ï½", "ï¼Ÿ?", is_question_search_mode=True)
    'è¿™å°±æ˜¯å‘½ï¼Œä½ èº²éƒ½èº²ä¸æ‰â€è¿™å¥è¯ç‰¹åˆ«æœ‰æ¢—ï¼Œå¸¦ç€ç‚¹å°ä¿çš®çš„è°ƒä¾ƒæ„Ÿï¼Œåƒæœ‹å‹é—´çš„è½»æ¾äº’åŠ¨ï¼Œè®©äººçœ‹äº†å¿ä¸ä½ä¼šå¿ƒä¸€ç¬‘ï¼Œå¾ˆæœ‰æ—¥å¸¸æ‰“å‘æ—¶é—´çš„æ¬¢ä¹æ°›å›´ï½'

    >>> æŸ¥æ‰¾å¹¶æˆªæ–­("ä»è§†é¢‘é‡Œèƒ½æ„Ÿå—åˆ°å¤§å®¶å¯¹â€œä¸²é—¨â€æ˜¯å¦æœ‰ç”¨çš„å…³æ³¨ç‰¹åˆ«çœŸå®ï½å…¶å®åƒä¹‹å‰æåˆ°çš„ï¼Œä¸ç®¡æ˜¯ç²‰å°‘çš„åˆ›ä½œè€…äº’ç›¸æ”¯æŒï¼Œè¿˜æ˜¯å¸¦ç€çœŸè¯šå»äº’åŠ¨ï¼Œæ…¢æ…¢éƒ½èƒ½ç§¯ç´¯èµ·å‹å¥½çš„æ°›å›´ï¼Œå¯¹è´¦å·åˆæœŸç»è¥è¿˜æŒºæœ‰å¸®åŠ©çš„ã€‚ä½ æ˜¯åœ¨çº ç»“è‡ªå·±åšè´¦å·è¦ä¸è¦å°è¯•ä¸²é—¨ï¼Œè¿˜æ˜¯æƒ³çŸ¥é“æ€ä¹ˆè®©ä¸²é—¨æ•ˆæœæ›´å¥½å‘€")
    'ä»è§†é¢‘é‡Œèƒ½æ„Ÿå—åˆ°å¤§å®¶å¯¹â€œä¸²é—¨â€æ˜¯å¦æœ‰ç”¨çš„å…³æ³¨ç‰¹åˆ«çœŸå®ï½å…¶å®åƒä¹‹å‰æåˆ°çš„ï¼Œä¸ç®¡æ˜¯ç²‰å°‘çš„åˆ›ä½œè€…äº’ç›¸æ”¯æŒï¼Œè¿˜æ˜¯å¸¦ç€çœŸè¯šå»äº’åŠ¨ï¼Œæ…¢æ…¢éƒ½èƒ½ç§¯ç´¯èµ·å‹å¥½çš„æ°›å›´ï¼Œå¯¹è´¦å·åˆæœŸç»è¥è¿˜æŒºæœ‰å¸®åŠ©çš„ã€‚'
    >>> æŸ¥æ‰¾å¹¶æˆªæ–­("Hiï½ åˆšçœ‹åˆ°ä½ çš„é—®å€™å‘€ï¼äº’ç›¸å…³æ³¨å°±æ˜¯ç¼˜åˆ†ï¼Œä»Šå¤©æœ‰æ²¡æœ‰ä»€ä¹ˆæœ‰è¶£çš„äº‹å„¿æƒ³åˆ†äº«å‘€")
    'Hiï½ åˆšçœ‹åˆ°ä½ çš„é—®å€™å‘€ï¼'
    """

    # is_question_search_mode = '?' in target_puncts
    # last_punct_idx = -1
    
    # for punct in target_puncts:
    #     current_idx = text.rfind(punct)
    #     if current_idx > last_punct_idx:
    #         last_punct_idx = current_idx
    #         break

    # # return text[: last_punct_idx + 1] if last_punct_idx != -1 else text
    # if last_punct_idx == -1:
    #     return text

    
    all_i = []
    
    for punct in target_puncts:
        current_idx = text.rfind(punct)
        if current_idx > 0:
            all_i.append(current_idx)

    if not all_i:
        return text
    
    last_punct_idx = max(all_i)
    


    if len(text) * 0.5 < last_punct_idx or not is_question_search_mode:
        return text[: last_punct_idx + 1]

    return text[last_punct_idx + 1 :]

    # return text[: last_punct_idx + 1] if last_punct_idx != -1 else text


def truncate_at_last_punct_if_question(text: str) -> str:
    """
    è‹¥æ–‡æœ¬æœ«å°¾ï¼ˆå…è®¸å°¾éšç©ºç™½ï¼‰ä»¥åŠè§’?/å…¨è§’ï¼Ÿç»“å°¾ï¼Œæˆªæ–­åˆ°æœ€åä¸€ä¸ªä¸­æ–‡æ ‡ç‚¹ï¼ˆã€‚ï¼Ÿï¼ï¼‰æˆ–åŠè§’?!çš„ä½ç½®ã€‚

    Doctest æµ‹è¯•ç”¨ä¾‹ï¼š
    >>> truncate_at_last_punct_if_question("è¿™æ˜¯ç¬¬ä¸€æ®µã€‚è¿™æ˜¯ç¬¬äºŒæ®µï¼Ÿ")  # æœ€åæ ‡ç‚¹æ˜¯ã€‚
    'è¿™æ˜¯ç¬¬ä¸€æ®µã€‚'
    >>> truncate_at_last_punct_if_question("æµ‹è¯•1ï¼Ÿæµ‹è¯•2ï¼   ")  # æœ«å°¾å¸¦ç©ºç™½ï¼Œæœ€åæ ‡ç‚¹æ˜¯ï¼Ÿ
    'æµ‹è¯•2ï¼'
    >>> truncate_at_last_punct_if_question("ç¤ºä¾‹ï¼ç»“å°¾æ˜¯ï¼Ÿ")  # æœ€åæ ‡ç‚¹æ˜¯ï¼
    'ç¤ºä¾‹ï¼'
    >>> truncate_at_last_punct_if_question("åŠè§’!ç»“å°¾ï¼Ÿ")  # åŠè§’!åŒ¹é…
    'åŠè§’!'
    >>> truncate_at_last_punct_if_question("æ— ç›®æ ‡æ ‡ç‚¹ï¼Ÿ   ")  # æ— åŒ¹é…æ ‡ç‚¹ï¼Œè¿”å›åŸæ–‡
    'æ— ç›®æ ‡æ ‡ç‚¹'
    >>> truncate_at_last_punct_if_question("æ— é—®å·ç»“å°¾ï¼")  # éé—®å·ç»“å°¾ï¼Œè¿”å›åŸæ–‡
    'æ— é—®å·ç»“å°¾ï¼'
    >>> truncate_at_last_punct_if_question("")  # ç©ºå­—ç¬¦ä¸²è¾¹ç•ŒCase
    ''
    >>> truncate_at_last_punct_if_question("æ··åˆæ ‡ç‚¹ã€‚a?bï¼cï¼Ÿ")  # å¤šæ ‡ç‚¹å–æœ€åä¸€ä¸ª
    'æ··åˆæ ‡ç‚¹ã€‚'
    >>> truncate_at_last_punct_if_question("ä»è§†é¢‘é‡Œèƒ½æ„Ÿæœºè¿™ä»¶äº‹çš„å°å¾—ï½ä¸çŸ¥ï¼Œæœ‰çš„å°ä½œå“å‘€ï¼Ÿ")
    'ä»è§†é¢‘é‡Œèƒ½æ„Ÿæœºè¿™ä»¶äº‹çš„å°å¾—ï½'
    >>> truncate_at_last_punct_if_question("è¿™ä¸ªè§†é¢‘è¿˜, äºã€‚è¿™ä¸ªè§†é¢‘çš„ä¿¡æ¯å‘€ï¼Ÿæ¯”å¦‚å¯¹é‡Œé¢çš„æŸä¸ªæƒ…èŠ‚çš„è®¨è®ºï¼Œè¿˜æ˜¯å…¶ä»–æ–¹é¢å‘¢ï¼Ÿ")
    'è¿™ä¸ªè§†é¢‘è¿˜, äºã€‚'
    >>> truncate_at_last_punct_if_question("çœ‹è¿™ä¸ªè§†é¢‘ç‰¹åˆ«æœ‰ä¸­å¼éŸµå‘³ï¼æ„Ÿè§‰è¿™ä¸ªè§†é¢‘é‡Œçš„ä¸²é—¨æ°›å›´å¥½è½»æ¾å‘€")
    'çœ‹è¿™ä¸ªè§†é¢‘ç‰¹åˆ«æœ‰ä¸­å¼éŸµå‘³ï¼æ„Ÿè§‰è¿™ä¸ªè§†é¢‘é‡Œçš„ä¸²é—¨æ°›å›´å¥½è½»æ¾å‘€'
    >>> truncate_at_last_punct_if_question("è§†é¢‘é‡Œâ€œåˆåˆ·åˆ°æˆ‘äº†å§ï¼Ÿè¿™å°±æ˜¯å‘½ï¼Œä½ èº²éƒ½èº²ä¸æ‰â€è¿™å¥è¯ç‰¹åˆ«æœ‰æ¢—ï¼Œå¸¦ç€ç‚¹å°ä¿çš®çš„è°ƒä¾ƒæ„Ÿï¼Œåƒæœ‹å‹é—´çš„è½»æ¾äº’åŠ¨ï¼Œè®©äººçœ‹äº†å¿ä¸ä½ä¼šå¿ƒä¸€ç¬‘ï¼Œå¾ˆæœ‰æ—¥å¸¸æ‰“å‘æ—¶é—´çš„æ¬¢ä¹æ°›å›´ï½ä¸çŸ¥é“ä½ æ˜¯è§‰å¾—è¿™å¥æ–‡æ¡ˆå¾ˆæœ‰è¶£ï¼Œè¿˜æ˜¯ä¹Ÿå–œæ¬¢è¿™ç§è½»æ¾å¥½ç©çš„å¯¹å£å‹è§†é¢‘é£æ ¼å‘€ï¼Ÿ	")
    'è¿™å°±æ˜¯å‘½ï¼Œä½ èº²éƒ½èº²ä¸æ‰â€è¿™å¥è¯ç‰¹åˆ«æœ‰æ¢—ï¼Œå¸¦ç€ç‚¹å°ä¿çš®çš„è°ƒä¾ƒæ„Ÿï¼Œåƒæœ‹å‹é—´çš„è½»æ¾äº’åŠ¨ï¼Œè®©äººçœ‹äº†å¿ä¸ä½ä¼šå¿ƒä¸€ç¬‘ï¼Œå¾ˆæœ‰æ—¥å¸¸æ‰“å‘æ—¶é—´çš„æ¬¢ä¹æ°›å›´'
    >>> truncate_at_last_punct_if_question("è§†é¢‘é‡Œâ€œä¸²é—¨äº†éƒ½åœ¨å®¶å—ï¼Ÿåœ¨å®¶çš„å±ä¸€å£°â€çš„æ‹›å‘¼ç‰¹åˆ«çƒ­æƒ…ï¼Œé…ä¸Šé‚£å¥ç¬‘å£°ï¼Œåƒé‚»é‡Œé—´çƒ­ç»œçš„äº’åŠ¨ï¼Œä¸€ä¸‹å­å°±æ‹‰è¿‘è·ç¦»ï¼Œç‰¹åˆ«æœ‰ç”Ÿæ´»é‡Œçš„çƒ­é—¹åŠ²å„¿ï½ ä¸è¿‡æˆ‘æœ‰ç‚¹å¥½å¥‡ï¼Œä½ å¹³æ—¶å’Œæœ‹å‹é‚»å±…ä¸²é—¨ï¼Œä¼šä¸ä¼šä¹Ÿåƒè¿™æ ·ç”¨è½»æ¾çš„æ–¹å¼æ‰“æ‹›å‘¼å‘€ï¼Ÿæˆ–è€…è§†é¢‘é‡Œæœ‰æ²¡æœ‰å“ªä¸ªå°ç»†èŠ‚è®©ä½ è§‰å¾—ç‰¹åˆ«æœ‰æ„æ€å‘€ï¼Ÿ	")
    'åœ¨å®¶çš„å±ä¸€å£°â€çš„æ‹›å‘¼ç‰¹åˆ«çƒ­æƒ…ï¼Œé…ä¸Šé‚£å¥ç¬‘å£°ï¼Œåƒé‚»é‡Œé—´çƒ­ç»œçš„äº’åŠ¨ï¼Œä¸€ä¸‹å­å°±æ‹‰è¿‘è·ç¦»ï¼Œç‰¹åˆ«æœ‰ç”Ÿæ´»é‡Œçš„çƒ­é—¹åŠ²å„¿'

    >>> truncate_at_last_punct_if_question("æ™šä¸Šå¥½å‘€ï½ æ¯å¤©æ”¶åˆ°ä½ çš„é—®å€™éƒ½è¶…å¼€å¿ƒï¼æ¯”å¿ƒå›èµ ï¼Œæ„¿ä½ ä¹Ÿè¢«æ¸©æŸ”å’Œå¥½è¿åŒ…å›´ï¼Œå…ƒæ°”æ»¡æ»¡ä¸€æ•´å¤©å‘€ï½")
    'æ™šä¸Šå¥½å‘€ï½ æ¯å¤©æ”¶åˆ°ä½ çš„é—®å€™éƒ½è¶…å¼€å¿ƒï¼æ¯”å¿ƒå›èµ ï¼Œæ„¿ä½ ä¹Ÿè¢«æ¸©æŸ”å’Œå¥½è¿åŒ…å›´ï¼Œå…ƒæ°”æ»¡æ»¡ä¸€æ•´å¤©å‘€ï½'
    >>> truncate_at_last_punct_if_question("Hiï½ åˆšçœ‹åˆ°ä½ çš„é—®å€™å‘€ï¼äº’ç›¸å…³æ³¨å°±æ˜¯ç¼˜åˆ†ï¼Œä»Šå¤©æœ‰æ²¡æœ‰ä»€ä¹ˆæœ‰è¶£çš„äº‹å„¿æƒ³åˆ†äº«å‘€ï¼Ÿ")
    'Hiï½ åˆšçœ‹åˆ°ä½ çš„é—®å€™å‘€ï¼'
    >>> truncate_at_last_punct_if_question("éšä¾¿èŠèŠä¼™ä¼´è®¡åˆ’åˆ›ä½œï½ ğŸŒŸğŸ€â†’å°å°å¤šï¼ä¹‹å‰æ‹è¿™ç±»å†…å®¹ï¼ŒæŠ•ç¨¿æ•°æ¯”ä¹‹å‰æ¶¨äº†ä¸€å€å¤šï¼Œå®Œæ’­ç‡ä¹Ÿæœ‰äºŒæˆå‡ºå¤´ï¼Œæ…¢æ…¢æ‘¸ç´¢ç€ç¡®å®åœ¨å˜å¥½ï¼Œä¸€èµ·åŠ æ²¹å‘€ï½ éœ€è¦æˆ‘é’ˆå¯¹å…¶ä»–è§†é¢‘ä¸»é¢˜ï¼ŒæŒ‰åŒæ ·é£æ ¼ç”Ÿæˆæ–°çš„è¯„è®ºå—ï¼Ÿ")
    'éšä¾¿èŠèŠä¼™ä¼´è®¡åˆ’åˆ›ä½œï½ ğŸŒŸğŸ€â†’å°å°å¤šï¼ä¹‹å‰æ‹è¿™ç±»å†…å®¹ï¼ŒæŠ•ç¨¿æ•°æ¯”ä¹‹å‰æ¶¨äº†ä¸€å€å¤šï¼Œå®Œæ’­ç‡ä¹Ÿæœ‰äºŒæˆå‡ºå¤´ï¼Œæ…¢æ…¢æ‘¸ç´¢ç€ç¡®å®åœ¨å˜å¥½ï¼Œä¸€èµ·åŠ æ²¹å‘€ï½'
    """
    while is_contains_question(text):
        text = æŸ¥æ‰¾å¹¶æˆªæ–­(text, "ï¼Ÿ?", is_question_search_mode=True)[:-1]
        if is_endswith_question(text):
            text = text[:-1]
        text = æŸ¥æ‰¾å¹¶æˆªæ–­(text)
    return text.strip()


def æˆªæ–­é—®å¥å’ŒåºŸè¯(txt):
    """
    æˆªæ–­é—®å¥å’ŒåºŸè¯ çš„ Docstring

    :param txt: è¯´æ˜
    :type txt: str
    :return: è¯´æ˜
    :rtype: str

    >>> æˆªæ–­é—®å¥å’ŒåºŸè¯("è§†é¢‘é‡Œçš„å¯¹è¯å¥½æœ‰çƒŸç«æ°”å‘€ï¼å¬ç€åƒåœ¨å’Œè€æœ‹å‹èŠå¤©ä¸€æ ·ï½ä½ å¹³æ—¶ç©è¿™ä¸ªæ¸¸æˆæ—¶ï¼Œæœ€å–œæ¬¢å’Œé‡Œé¢çš„å“ªä¸ªè§’è‰²äº’åŠ¨å‘€ï¼Ÿ")
    'è§†é¢‘é‡Œçš„å¯¹è¯å¥½æœ‰çƒŸç«æ°”å‘€ï¼å¬ç€åƒåœ¨å’Œè€æœ‹å‹èŠå¤©ä¸€æ ·ï½'
    >>> æˆªæ–­é—®å¥å’ŒåºŸè¯("å“‡ï¼ŒæŠŠçº¢è±†å…ƒç´ ç”»æˆå½©ç»˜ä¹Ÿå¤ªæœ‰åˆ›æ„äº†å§ï¼æˆ‘ä¹‹å‰ç”»å½©ç»˜æ€»æ‹…å¿ƒé¢œæ–™è¹­æ‰ï¼Œåæ¥å‘ç°å…ˆæ¶‚å±‚è–„å®šå¦†ç²‰ä¼šå¥½å¾ˆå¤šï½ä½ å¹³æ—¶ä¹Ÿå¸¸åšè¿™ç§æœ‰è¯—æ„çš„å½©ç»˜å—ï¼Ÿ")
    'å“‡ï¼ŒæŠŠçº¢è±†å…ƒç´ ç”»æˆå½©ç»˜ä¹Ÿå¤ªæœ‰åˆ›æ„äº†å§ï¼æˆ‘ä¹‹å‰ç”»å½©ç»˜æ€»æ‹…å¿ƒé¢œæ–™è¹­æ‰ï¼Œåæ¥å‘ç°å…ˆæ¶‚å±‚è–„å®šå¦†ç²‰ä¼šå¥½å¾ˆå¤šï½'
    >>> æˆªæ–­é—®å¥å’ŒåºŸè¯("è¿™æ¸å˜ç´«è“çš„ç»’èŠ±ä¹Ÿå¤ªæ¸©æŸ”äº†å§ï¼æˆ‘ä¹‹å‰åšç»’èŠ±æ€»æ‰ç»’ï¼Œåæ¥ç”¨å°‘é‡å®šå‹å–·é›¾å°±å¥½å¾ˆå¤š~ä½ å¹³æ—¶ä¹Ÿå–œæ¬¢æˆ´è¿™ç±»é…é¥°å—ï¼Ÿ")
    'è¿™æ¸å˜ç´«è“çš„ç»’èŠ±ä¹Ÿå¤ªæ¸©æŸ”äº†å§ï¼æˆ‘ä¹‹å‰åšç»’èŠ±æ€»æ‰ç»’ï¼Œåæ¥ç”¨å°‘é‡å®šå‹å–·é›¾å°±å¥½å¾ˆå¤š~'
    >>> æˆªæ–­é—®å¥å’ŒåºŸè¯("ä»è§†é¢‘é‡Œèƒ½æ„Ÿå—åˆ°æ‰‹å·¥ç¼–ç»³çš„ç”¨å¿ƒï¼Œè²”è²…å’Œåé‡‘å…½çš„æ­é…å¾ˆæœ‰ç‰¹è‰²ï¼Œè‰²å½©ä¸°å¯Œä¹Ÿæ˜¾å¾—å¾ˆæœ‰æ´»åŠ›å‘¢ï¼è¦æ˜¯ä½ åœ¨ç¼–ç»³é…è‰²æˆ–æŠ€å·§ä¸Šæœ‰æƒ³")
    'æ‰‹å·¥ç¼–ç»³çš„ç”¨å¿ƒï¼Œè²”è²…å’Œåé‡‘å…½çš„æ­é…å¾ˆæœ‰ç‰¹è‰²ï¼Œè‰²å½©ä¸°å¯Œä¹Ÿæ˜¾å¾—å¾ˆæœ‰æ´»åŠ›å‘¢ï¼è¦æ˜¯ä½ åœ¨ç¼–ç»³é…è‰²æˆ–æŠ€å·§ä¸Šæœ‰æƒ³'
    >>> æˆªæ–­é—®å¥å’ŒåºŸè¯("çœ‹è§†é¢‘é‡Œèƒ½æ„Ÿå—åˆ°æ‰‹å·¥ç¼–ç»³çš„ç”¨å¿ƒï¼Œè²”è²…å’Œåé‡‘å…½çš„æ­é…å¾ˆæœ‰ç‰¹è‰²ï¼Œè‰²å½©ä¸°å¯Œä¹Ÿæ˜¾å¾—å¾ˆæœ‰æ´»åŠ›å‘¢ï¼è¦æ˜¯ä½ åœ¨ç¼–ç»³é…è‰²æˆ–æŠ€å·§ä¸Šæœ‰æƒ³")
    'æ‰‹å·¥ç¼–ç»³çš„ç”¨å¿ƒï¼Œè²”è²…å’Œåé‡‘å…½çš„æ­é…å¾ˆæœ‰ç‰¹è‰²ï¼Œè‰²å½©ä¸°å¯Œä¹Ÿæ˜¾å¾—å¾ˆæœ‰æ´»åŠ›å‘¢ï¼è¦æ˜¯ä½ åœ¨ç¼–ç»³é…è‰²æˆ–æŠ€å·§ä¸Šæœ‰æƒ³'
    >>> æˆªæ–­é—®å¥å’ŒåºŸè¯("æ„Ÿè§‰è¿™ä¸ªè§†é¢‘é‡Œçš„ä¸²é—¨æ°›å›´å¥½è½»æ¾å‘€ï¼ä¸»åŠ¨å»ä¸²é—¨äº’åŠ¨è¿˜æŒºèƒ½æ‹‰è¿‘è·ç¦»çš„ï½æˆ‘ä¹‹å‰æƒ³ä¸²é—¨æ€»æœ‰ç‚¹ä¸å¥½æ„æ€å¼€å£ï¼Œä½ å¹³æ—¶ä¸²é—¨çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šå…ˆä»å“ªäº›è¯é¢˜èŠèµ·ï¼Œæ¥è®©äº’åŠ¨æ›´è‡ªç„¶å‘€ï½")
    'ä¸²é—¨æ°›å›´å¥½è½»æ¾å‘€ï¼ä¸»åŠ¨å»ä¸²é—¨äº’åŠ¨è¿˜æŒºèƒ½æ‹‰è¿‘è·ç¦»çš„ï½æˆ‘ä¹‹å‰æƒ³ä¸²é—¨æ€»æœ‰ç‚¹ä¸å¥½æ„æ€å¼€å£ï¼Œä½ å¹³æ—¶ä¸²é—¨çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šå…ˆä»å“ªäº›è¯é¢˜èŠèµ·ï¼Œæ¥è®©äº’åŠ¨æ›´è‡ªç„¶å‘€ï½'
    >>> æˆªæ–­é—®å¥å’ŒåºŸè¯("çœ‹è¿™ä¸ªè§†é¢‘ç‰¹åˆ«æœ‰ä¸­å¼éŸµå‘³ï¼æ„Ÿè§‰è¿™ä¸ªè§†é¢‘é‡Œçš„ä¸²é—¨æ°›å›´å¥½è½»æ¾å‘€")
    'ç‰¹åˆ«æœ‰ä¸­å¼éŸµå‘³ï¼æ„Ÿè§‰è¿™ä¸ªè§†é¢‘é‡Œçš„ä¸²é—¨æ°›å›´å¥½è½»æ¾å‘€'
    >>> æˆªæ–­é—®å¥å’ŒåºŸè¯("çœ‹è¿™ä¸ªè§†é¢‘ç‰¹åˆ«æœ‰ä¸­å¼éŸµå‘³ï¼å›½ç”»é£æ ¼çš„æŸ¿å­ç”»å¾—æ¸©æ¶¦åˆé²œæ´»ï¼Œé…ä¸Šéœœé™åƒä¸æŸ¿çš„ä¹ ä¿—ï¼Œæ—¢é€ç€èŠ‚æ°”çš„ä»ªå¼æ„Ÿï¼Œåˆæ»¡æ˜¯ç”Ÿæ´»é‡Œçš„ç¾å¥½å¯“æ„ï¼Œè®©äººè§‰å¾—å¾ˆæ²»æ„ˆï½")
    'ç‰¹åˆ«æœ‰ä¸­å¼éŸµå‘³ï¼å›½ç”»é£æ ¼çš„æŸ¿å­ç”»å¾—æ¸©æ¶¦åˆé²œæ´»ï¼Œé…ä¸Šéœœé™åƒä¸æŸ¿çš„ä¹ ä¿—ï¼Œæ—¢é€ç€èŠ‚æ°”çš„ä»ªå¼æ„Ÿï¼Œåˆæ»¡æ˜¯ç”Ÿæ´»é‡Œçš„ç¾å¥½å¯“æ„ï¼Œè®©äººè§‰å¾—å¾ˆæ²»æ„ˆï½'
    >>> æˆªæ–­é—®å¥å’ŒåºŸè¯("çœ‹è¿™ä¸ªè§†é¢‘ä¹Ÿå¤ªå¯çˆ±å•¦ï¼å¹¼å´½ç©¿æ­çš„å†…å®¹é€ç€æ»¡æ»¡çš„ç«¥çœŸï¼Œç¬¬13å¤©å°±æœ‰46ä½ç²‰ä¸ï¼Œèƒ½æ„Ÿè§‰åˆ°å¦ˆå¦ˆå¸¦ç€å®å®åšè‡ªåª’ä½“çš„ç”¨å¿ƒå’Œå°æˆå°±æ„Ÿï¼Œâ€œæ¬¢è¿å§¨å§¨ä»¬ä¸²é—¨â€çš„è¯´æ³•ä¹Ÿç‰¹åˆ«äº²åˆ‡ï½")
    'ä¹Ÿå¤ªå¯çˆ±å•¦ï¼å¹¼å´½ç©¿æ­çš„å†…å®¹é€ç€æ»¡æ»¡çš„ç«¥çœŸï¼Œç¬¬13å¤©å°±æœ‰46ä½ç²‰ä¸ï¼Œèƒ½æ„Ÿè§‰åˆ°å¦ˆå¦ˆå¸¦ç€å®å®åšè‡ªåª’ä½“çš„ç”¨å¿ƒå’Œå°æˆå°±æ„Ÿï¼Œâ€œæ¬¢è¿å§¨å§¨ä»¬ä¸²é—¨â€çš„è¯´æ³•ä¹Ÿç‰¹åˆ«äº²åˆ‡ï½'
    >>> æˆªæ–­é—®å¥å’ŒåºŸè¯("èƒ½æ„Ÿå—åˆ°è§†é¢‘é‡Œç‰¹åˆ«çƒ­æƒ…çš„äº’åŠ¨åŠ²å„¿ï¼Œâ€œä½ æ¥æˆ‘å¾€â€çš„ä¸²é—¨é‚€çº¦ç‰¹åˆ«äº²åˆ‡ï¼Œè¿˜é€ç€è‚¡ä¸»åŠ¨æ‹‰è¿‘å½¼æ­¤è·ç¦»çš„å¯çˆ±ï½")
    'ç‰¹åˆ«çƒ­æƒ…çš„äº’åŠ¨åŠ²å„¿ï¼Œâ€œä½ æ¥æˆ‘å¾€â€çš„ä¸²é—¨é‚€çº¦ç‰¹åˆ«äº²åˆ‡ï¼Œè¿˜é€ç€è‚¡ä¸»åŠ¨æ‹‰è¿‘å½¼æ­¤è·ç¦»çš„å¯çˆ±ï½'
    >>> æˆªæ–­é—®å¥å’ŒåºŸè¯("èƒ½æ„Ÿå—åˆ°ä½ å¯¹è§†é¢‘æµé‡çš„å…³æ³¨ï¼Œè¿˜ç‰¹åˆ«çƒ­æƒ…åœ°é‚€è¯·å¤§å®¶ä¸²é—¨å¹¶æ‰¿è¯ºå›ç¤¼ï¼Œè¿™ç§ä¸»åŠ¨äº’åŠ¨çš„å¿ƒæ„ç‰¹åˆ«å®åœ¨ï¼Œå¾ˆå®¹æ˜“è®©äººæ„¿æ„å‚ä¸ï½")
    'æµé‡çš„å…³æ³¨ï¼Œè¿˜ç‰¹åˆ«çƒ­æƒ…åœ°é‚€è¯·å¤§å®¶ä¸²é—¨å¹¶æ‰¿è¯ºå›ç¤¼ï¼Œè¿™ç§ä¸»åŠ¨äº’åŠ¨çš„å¿ƒæ„ç‰¹åˆ«å®åœ¨ï¼Œå¾ˆå®¹æ˜“è®©äººæ„¿æ„å‚ä¸ï½'
    >>> æˆªæ–­é—®å¥å’ŒåºŸè¯("çœ‹äº†è¿™ä¸ªè§†é¢‘ï¼Œæ„Ÿè§‰ä½ åˆ†äº«çš„èµ·è¯‰æ­¥éª¤è¿˜æŒºè¯¦ç»†çš„ï¼Œä»ç«‹æ¡ˆçš„é€‰æ‹©ï¼Œåˆ°åˆåŒçº çº·ç±»åˆ«çš„æŸ¥çœ‹ï¼Œå†åˆ°ææ–™çš„å‡†å¤‡å’Œæäº¤ï¼Œéƒ½æœ‰æåˆ°ã€‚")
    'æ„Ÿè§‰ä½ åˆ†äº«çš„èµ·è¯‰æ­¥éª¤è¿˜æŒºè¯¦ç»†çš„ï¼Œä»ç«‹æ¡ˆçš„é€‰æ‹©ï¼Œåˆ°åˆåŒçº çº·ç±»åˆ«çš„æŸ¥çœ‹ï¼Œå†åˆ°ææ–™çš„å‡†å¤‡å’Œæäº¤ï¼Œéƒ½æœ‰æåˆ°ã€‚'
    >>> æˆªæ–­é—®å¥å’ŒåºŸè¯("çœ‹è¿™ä¸ªè§†é¢‘ï¼Œèƒ½æ„Ÿå—åˆ°ä½ å‡†å¤‡å»ä¸²é—¨çš„é›€è·ƒåŠ²å„¿ï¼Œä¸€ä¸Šæ¥å°±å–Šç€ç›®æ ‡500å®¶")
    'ä½ å‡†å¤‡å»ä¸²é—¨çš„é›€è·ƒåŠ²å„¿ï¼Œä¸€ä¸Šæ¥å°±å–Šç€ç›®æ ‡500å®¶'
    >>> æˆªæ–­é—®å¥å’ŒåºŸè¯("èƒ½æ„Ÿå—åˆ°ä½ é¢å¯¹ä½æ’­æ”¾é‡çš„å›°æƒ‘ï¼Œ15å°æ—¶åªæœ‰16æ¬¡æ’­æ”¾ï¼Œæ˜æ˜è´¦å·å†…å®¹éƒ½æ­£å¸¸ï¼Œæ¢è°éƒ½ä¼šæœ‰ç‚¹æ‘¸ä¸ç€å¤´è„‘å§ï½")
    'ä½ é¢å¯¹ä½æ’­æ”¾é‡çš„å›°æƒ‘ï¼Œ15å°æ—¶åªæœ‰16æ¬¡æ’­æ”¾ï¼Œæ˜æ˜è´¦å·å†…å®¹éƒ½æ­£å¸¸ï¼Œæ¢è°éƒ½ä¼šæœ‰ç‚¹æ‘¸ä¸ç€å¤´è„‘å§ï½'

    >>> æˆªæ–­é—®å¥å’ŒåºŸè¯("çœ‹è§†é¢‘æ—¶ç‰¹åˆ«èƒ½æ„Ÿå—åˆ°å…¨èŒå®å¦ˆå…¼é¡¾å¸¦å¨ƒå’Œåšè‡ªåª’ä½“çš„ä¸å®¹æ˜“ï¼Œ30å¤©æ‘¸çˆ¬æ»šæ‰“è¿æ¥ç¬¬ä¸€ä¸ªç ´ä¸‡æ’­æ”¾ï¼Œè¿™ä»½åšæŒç‰¹åˆ«è®©äººä½©æœï¼Œå°¤å…¶æ˜¯é‚£å¥â€œå¹²å°±å®Œäº†â€ï¼Œç‰¹åˆ«æœ‰åŠ²å„¿ï¼")
    'ç‰¹åˆ«èƒ½æ„Ÿå—åˆ°å…¨èŒå®å¦ˆå…¼é¡¾å¸¦å¨ƒå’Œåšè‡ªåª’ä½“çš„ä¸å®¹æ˜“ï¼Œ30å¤©æ‘¸çˆ¬æ»šæ‰“è¿æ¥ç¬¬ä¸€ä¸ªç ´ä¸‡æ’­æ”¾ï¼Œè¿™ä»½åšæŒç‰¹åˆ«è®©äººä½©æœï¼Œå°¤å…¶æ˜¯é‚£å¥â€œå¹²å°±å®Œäº†â€ï¼Œç‰¹åˆ«æœ‰åŠ²å„¿ï¼'
    >>> æˆªæ–­é—®å¥å’ŒåºŸè¯("çœ‹è§†é¢‘æ—¶è§‰å¾—ä½ è§£æä¼™ä¼´è®¡åˆ’ç‰¹åˆ«å®åœ¨ï¼")
    'è§‰å¾—ä½ è§£æä¼™ä¼´è®¡åˆ’ç‰¹åˆ«å®åœ¨ï¼'
    """
    # s = truncate_at_last_punct_if_question(ç²¾ç¡®è¯†åˆ«å¹¶æˆªæ–­åºŸè¯(txt))
    s = truncate_at_last_punct_if_question(txt)
    # s = re.sub(r"^(æ„Ÿè§‰|èƒ½æ„Ÿå—|çœ‹|ä»).*?è§†é¢‘(é‡Œ)*(çš„)*(ï¼Œ)*", "", s)
    s = re.sub(r"^(æ„Ÿè§‰|èƒ½æ„Ÿå—|çœ‹|ä»).*?è§†é¢‘(é‡Œ|æ—¶)*(çš„)*(ï¼Œ)*", "", s)
    return re.sub("^èƒ½æ„Ÿå—(åˆ°)*", "", s)


def å¯¹è±†åŒ…å›å¤è¿›è¡Œæ‰€æœ‰çš„å¿…è¦å¤„ç†(txt):
    """
    å¯¹è±†åŒ…å›å¤è¿›è¡Œæ‰€æœ‰çš„å¿…è¦å¤„ç† çš„ Docstring

    :param txt: è¯´æ˜
    >>> å¯¹è±†åŒ…å›å¤è¿›è¡Œæ‰€æœ‰çš„å¿…è¦å¤„ç†("è§†é¢‘é‡Œçš„å¯¹è¯å¥½æœ‰çƒŸç«æ°”å‘€ï¼å¬ç€åƒåœ¨å’Œè€æœ‹å‹èŠå¤©ä¸€æ ·ï¼ä½ å¹³æ—¶ç©è¿™ä¸ªæ¸¸æˆæ—¶ï¼Œæœ€å–œæ¬¢å’Œé‡Œé¢çš„å“ªä¸ªè§’è‰²äº’åŠ¨å‘€ï¼Ÿ")
    'å¯¹è¯å¥½æœ‰çƒŸç«æ°”å‘€ï¼å¬ç€åƒåœ¨å’Œè€æœ‹å‹èŠå¤©ä¸€æ ·ï¼'

    #>>> å¯¹è±†åŒ…å›å¤è¿›è¡Œæ‰€æœ‰çš„å¿…è¦å¤„ç†("å“‡è¿™å¹¿åœºä¹Ÿå¤ªå¼€é˜”äº†å§ï¼é’å±±é…é«˜æ¥¼çš„æ™¯è‰²å¥½èˆ’æœï¼Œä¸º500å®¶çš„ç›®æ ‡åŠ æ²¹å‘€ï½")
    """
    txt = æˆªæ–­é—®å¥å’ŒåºŸè¯(txt)
    txt = replace_trailing_tilde(txt)
    txt = re.sub(r"^(è§†é¢‘é‡Œ)çš„{0,1}", "", txt)
    return txt


def has_valid_result(txt):
    """
    åˆ¤æ–­è¾“å…¥æ–‡æœ¬å»é™¤éæ±‰å­—åæ˜¯å¦ä¸ä»¥â€œæ— â€ç»“å°¾ï¼ˆå³å­˜åœ¨æœ‰æ•ˆç»“æœï¼‰ï¼ŒåŒæ—¶å¤„ç†å¼•å·åŒ…è£¹â€œæ— â€çš„æƒ…å†µã€‚

    æ ¸å¿ƒè§„åˆ™ï¼š
    1. å…ˆå»é™¤æ–‡æœ¬é¦–å°¾ç©ºç™½å­—ç¬¦ï¼›
    2. è‹¥æ¸…æ´—åçš„æ–‡æœ¬åŒ…å«ã€Œâ€œæ— â€ã€ã€Œ"æ— "ã€ã€Œâ€˜æ— â€™ã€ã€Œ'æ— 'ã€ï¼Œç›´æ¥è¿”å›Falseï¼›
    3. è¿‡æ»¤å‡ºæ–‡æœ¬ä¸­æ‰€æœ‰æ±‰å­—ï¼ˆUnicodeèŒƒå›´ï¼š\u4e00-\u9fa5ï¼‰ï¼›
    4. è‹¥è¿‡æ»¤åçš„æ±‰å­—å­—ç¬¦ä¸²ä¸ºç©º â†’ è¿”å›Falseï¼›
    5. è‹¥è¿‡æ»¤åçš„æ±‰å­—å­—ç¬¦ä¸²æ˜¯ã€Œæ— ã€æˆ–ä»¥ã€Œæ— ã€ç»“å°¾ â†’ è¿”å›Falseï¼›
    6. å…¶ä»–æƒ…å†µè¿”å›Trueï¼ˆè¡¨ç¤ºæœ‰æœ‰æ•ˆç»“æœï¼‰ã€‚

    Doctestå•å…ƒæµ‹è¯•ï¼ˆè¦†ç›–æ‰€æœ‰æ ¸å¿ƒåœºæ™¯ï¼‰ï¼š
    >>> has_valid_result("")  # ç©ºå­—ç¬¦ä¸²
    False
    >>> has_valid_result("   ")  # å…¨ç©ºç™½å­—ç¬¦
    False
    >>> has_valid_result("æ— ")  # ä»…å«ã€Œæ— ã€
    False
    >>> has_valid_result("æŸ¥è¯¢ç»“æœæ— ")  # æ±‰å­—ç»“å°¾ä¸ºã€Œæ— ã€
    False
    >>> has_valid_result("æŸ¥è¯¢ç»“æœæ— 123ï¿¥%")  # ç»“å°¾ã€Œæ— ã€+éæ±‰å­—
    False
    >>> has_valid_result("â€œæ— â€")  # ä¸­æ–‡åŒå¼•å·åŒ…è£¹ã€Œæ— ã€
    False
    >>> has_valid_result('"æ— "')  # è‹±æ–‡åŒå¼•å·åŒ…è£¹ã€Œæ— ã€
    False
    >>> has_valid_result("â€˜æ— â€™")  # ä¸­æ–‡å•å¼•å·åŒ…è£¹ã€Œæ— ã€
    False
    >>> has_valid_result("'æ— '")  # è‹±æ–‡å•å¼•å·åŒ…è£¹ã€Œæ— ã€
    False
    >>> has_valid_result("åŒ…å«â€œæ— â€çš„æ— æ•ˆæ–‡æœ¬")  # æ–‡æœ¬ä¸­å«ä¸­æ–‡åŒå¼•å·ã€Œæ— ã€
    False
    >>> has_valid_result("åŒ…å«'æ— 'çš„æ— æ•ˆæ–‡æœ¬")  # æ–‡æœ¬ä¸­å«è‹±æ–‡å•å¼•å·ã€Œæ— ã€
    False
    >>> has_valid_result("æŸ¥è¯¢ç»“æœä¸ºåˆæ ¼")  # æ­£å¸¸æœ‰æ•ˆç»“å°¾
    True
    >>> has_valid_result("æŸ¥è¯¢ç»“æœä¸ºåˆæ ¼123@")  # æœ‰æ•ˆç»“å°¾+éæ±‰å­—
    True
    >>> has_valid_result("  æµ‹è¯•ç»“æœæ­£å¸¸  ")  # é¦–å°¾ç©ºç™½+æœ‰æ•ˆç»“å°¾
    True
    >>> has_valid_result("æ— æœ‰æ•ˆå†…å®¹ä½†ç»“å°¾åˆæ ¼")  # å¼€å¤´ã€Œæ— ã€+ç»“å°¾æœ‰æ•ˆ
    True
    >>> has_valid_result("123æµ‹è¯•456")  # éæ±‰å­—åŒ…å›´æœ‰æ•ˆæ±‰å­—
    True
    >>> has_valid_result("abc123ï¿¥%")  # å…¨éæ±‰å­—
    False
    >>> has_valid_result("ç»“æœæ— æ— ")  # è¿‡æ»¤åç»“å°¾ä¸ºã€Œæ— ã€
    False
    >>> has_valid_result("è¯·ä½ æ˜ç¡®ä¸€ä¸‹å…·ä½“éœ€æ±‚ï¼Œæ¯”å¦‚å¯¹è¿™æ®µæ–‡æœ¬è¿›è¡Œæ¶¦è‰²ã€æ¦‚æ‹¬ã€æå–å…³é”®ä¿¡æ¯ã€åˆ†æè§‚ç‚¹ç­‰ï¼Œè¿™æ ·æˆ‘æ‰èƒ½æ›´å‡†ç¡®åœ°ä¸ºä½ æä¾›æœåŠ¡å‘€ã€‚")
    False
    >>> has_valid_result("æŠ±æ­‰ï¼Œæˆ‘æ— æ³•å›ç­”ä½ çš„é—®é¢˜")
    False
    >>> has_valid_result("ä¸ºäº†ç²¾å‡†æ‰§è¡Œé“¾æ¥ä¸­çš„æç¤ºè¯ï¼Œæˆ‘éœ€è¦å…ˆè·å–é“¾æ¥å†…çš„å…·ä½“è¦æ±‚ï½ ä½ å¯ä»¥å°†é“¾æ¥é‡Œçš„æç¤ºè¯å†…å®¹å¤åˆ¶ç²˜è´´è¿‡æ¥ï¼Œæˆ‘ä¼šä¸¥æ ¼æŒ‰ç…§è¦æ±‚å®Œæˆæ“ä½œï¼Œè¦ä¸è¦ç°åœ¨æå–å¹¶åˆ†äº«ä¸€ä¸‹æç¤ºè¯å‘€ï¼Ÿ")
    False
    >>> has_valid_result("å¾ˆæŠ±æ­‰ï¼Œè¯¥ç½‘é¡µè§£æå¤±è´¥å•¦ï¼Œå¯èƒ½æ˜¯ä¸æ”¯æŒçš„ç½‘é¡µç±»å‹å¯¼è‡´çš„ã€‚ä½ å¯ä»¥æ£€æŸ¥ä¸€ä¸‹ç½‘é¡µé“¾æ¥æ˜¯å¦æ­£ç¡®ï¼Œæˆ–è€…ç¨åå†å°è¯•è®¿é—®ï¼Œéœ€è¦æˆ‘å¸®ä½ é‡æ–°éªŒè¯è¿™ä¸ªé“¾æ¥çš„æœ‰æ•ˆæ€§å—ï¼Ÿ")
    False
    >>> has_valid_result("å¾ˆæŠ±æ­‰ï¼Œè¯¥ç½‘é¡µè§£æå¤±è´¥å•¦ï¼Œå¯èƒ½æ˜¯ä¸æ”¯æŒçš„ç½‘é¡µç±»å‹å¯¼è‡´çš„ã€‚")
    False
    >>> has_valid_result("å¾ˆæŠ±æ­‰ï¼Œå½“å‰é“¾æ¥çš„å›¾ç‰‡è§£æå¤±è´¥å•¦ï¼Œæš‚æ—¶æ— æ³•æå–åˆ°è¯¦ç»†ä¿¡æ¯ï¼Œå¯èƒ½æ˜¯è¯¥ç½‘é¡µç±»å‹ä¸è¢«æ”¯æŒã€‚è¦ä¸è¦æˆ‘å¸®ä½ å°è¯•é‡æ–°æ ¡éªŒè¿™ä¸ªå›¾ç‰‡é“¾æ¥çš„æœ‰æ•ˆæ€§ï¼Œçœ‹çœ‹æ˜¯å¦èƒ½æ‰¾åˆ°å¯è®¿é—®çš„é€”å¾„ï¼Ÿ")
    False
    >>> has_valid_result(None)
    False
    """
    # æ­¥éª¤1ï¼šå»é™¤é¦–å°¾ç©ºç™½å­—ç¬¦
    cleaned_txt = txt.strip() if txt else txt

    if not cleaned_txt:
        return False

    # if cleaned_txt.startswith("æŠ±æ­‰"):
    if re.match("^(å¾ˆ|éå¸¸)*æŠ±æ­‰", cleaned_txt):
        return False

    # æ­¥éª¤2ï¼šæ£€æŸ¥æ˜¯å¦åŒ…å«å¼•å·åŒ…è£¹çš„ã€Œæ— ã€ï¼ˆä¸­è‹±æ–‡å•/åŒå¼•å·ï¼‰
    invalid_quote_patterns = {"â€œæ— â€", '"æ— "', "â€˜æ— â€™", "'æ— '", "å…·ä½“éœ€æ±‚", "é“¾æ¥"}
    if any(pattern in cleaned_txt for pattern in invalid_quote_patterns):
        return False

    # æ­¥éª¤3ï¼šè¿‡æ»¤å‡ºæ‰€æœ‰æ±‰å­—ï¼ˆä»…ä¿ç•™Unicodeæ±‰å­—èŒƒå›´çš„å­—ç¬¦ï¼‰
    chinese_chars = [char for char in cleaned_txt if "\u4e00" <= char <= "\u9fa5"]
    chinese_str = "".join(chinese_chars)

    # æ­¥éª¤4ï¼šè¿‡æ»¤åæ— æ±‰å­— â†’ æ— æœ‰æ•ˆç»“æœ
    if not chinese_str:
        return False

    # æ­¥éª¤5ï¼šè¿‡æ»¤åæ˜¯ã€Œæ— ã€æˆ–ç»“å°¾ä¸ºã€Œæ— ã€â†’ æ— æœ‰æ•ˆç»“æœ
    if chinese_str == "æ— " or chinese_str.endswith("æ— "):
        return False

    # æ­¥éª¤6ï¼šå…¶ä»–æƒ…å†µ â†’ æœ‰æœ‰æ•ˆç»“æœ
    return True


def is_valid_upper_6chars(s: str) -> bool:
    """
    åˆ¤æ–­è¾“å…¥å­—ç¬¦ä¸²æ˜¯å¦ä¸¥æ ¼ç”±A-Zå¤§å†™è‹±æ–‡å­—æ¯ç»„æˆï¼Œä¸”é•¿åº¦æ°å¥½ä¸º6ä½ã€‚

    å‚æ•°:
        s: å¾…éªŒè¯çš„å­—ç¬¦ä¸²

    è¿”å›:
        å¸ƒå°”å€¼ï¼šç¬¦åˆæ¡ä»¶è¿”å›Trueï¼Œå¦åˆ™è¿”å›False

    æµ‹è¯•ç”¨ä¾‹:
    >>> is_valid_upper_6chars('ABCDEF')  # æ ‡å‡†ç¬¦åˆæ¡ä»¶çš„æ¡ˆä¾‹
    True
    >>> is_valid_upper_6chars('ABCDE')   # é•¿åº¦ä¸è¶³6ä½
    False
    >>> is_valid_upper_6chars('ABCDEFG') # é•¿åº¦è¶…è¿‡6ä½
    False
    >>> is_valid_upper_6chars('AbcDEF')  # åŒ…å«å°å†™å­—æ¯
    False
    >>> is_valid_upper_6chars('ABC1EF')  # åŒ…å«æ•°å­—
    False
    >>> is_valid_upper_6chars('ABC@EF')  # åŒ…å«ç‰¹æ®Šç¬¦å·
    False
    >>> is_valid_upper_6chars('')        # ç©ºå­—ç¬¦ä¸²
    False
    >>> is_valid_upper_6chars('123456')  # å…¨æ•°å­—
    False
    >>> is_valid_upper_6chars('XYZUVW')  # å¦ä¸€ä¸ªåˆæ³•å¤§å†™å­—æ¯ç»„åˆ
    True
    >>> is_valid_upper_6chars('A0B9C8')  # å­—æ¯æ•°å­—æ··åˆ
    False
    >>> is_valid_upper_6chars('AAAAAA')  # é‡å¤å¤§å†™å­—æ¯
    True
    >>> is_valid_upper_6chars('ABC DEF') # åŒ…å«ç©ºæ ¼
    False
    >>> is_valid_upper_6chars(None)
    False
    """
    # æ­£åˆ™è¡¨è¾¾å¼è¯´æ˜ï¼š
    # [A-Z] åŒ¹é…å•ä¸ªå¤§å†™è‹±æ–‡å­—æ¯
    # {6} é™å®šæ°å¥½åŒ¹é…6ä¸ª
    # re.fullmatch ç¡®ä¿æ•´ä¸ªå­—ç¬¦ä¸²å®Œå…¨åŒ¹é…ï¼ˆè€Œééƒ¨åˆ†åŒ¹é…ï¼‰
    match_result = re.fullmatch(r"[A-Z]{6}", s or "")
    return match_result is not None


def replace_trailing_tilde(s: str) -> str:
    """
    å°†å­—ç¬¦ä¸²ç»“å°¾çš„å…¨è§’ï½æˆ–åŠè§’~éšæœºæ›¿æ¢ä¸ºï¼š
    åŠè§’.ã€å…¨è§’ã€‚ã€åŠè§’!ã€å…¨è§’ï¼ã€ç©ºå­—ç¬¦ä¸­çš„ä¸€ä¸ªã€‚

    æµ‹è¯•è¯´æ˜ï¼šè®¾ç½®éšæœºç§å­ä»¥ç¡®ä¿æµ‹è¯•ç»“æœå¯å¤ç°
    >>> random.seed(2)  # æ›´æ¢ç§å­é¿å…å’Œæ—§æµ‹è¯•å†²çªï¼Œä¿è¯ç»“æœç¨³å®š
    >>> replace_trailing_tilde("hello~")  # åŠè§’~ï¼Œéšæœºé€‰åˆ°åŠè§’!
    'hello.'
    >>> replace_trailing_tilde("worldï½")  # å…¨è§’ï½ï¼Œéšæœºé€‰åˆ°å…¨è§’ã€‚
    'world.'
    >>> replace_trailing_tilde("test~")   # åŠè§’~ï¼Œéšæœºé€‰åˆ°ç©ºå­—ç¬¦
    'test.'
    >>> replace_trailing_tilde("demoï½")  # å…¨è§’ï½ï¼Œéšæœºé€‰åˆ°åŠè§’.
    'demoã€‚'
    >>> replace_trailing_tilde("no_tilde")  # æ— ç»“å°¾~ï¼Œè¿”å›åŸå­—ç¬¦ä¸²
    'no_tilde'
    >>> replace_trailing_tilde("")  # ç©ºå­—ç¬¦ä¸²è¿”å›ç©º
    ''
    >>> replace_trailing_tilde("~~")  # ä»…æ›¿æ¢æœ€åä¸€ä¸ªåŠè§’~ï¼Œé€‰åˆ°å…¨è§’ï¼
    '~ï¼'
    >>> replace_trailing_tilde("ï½ï½")  # ä»…æ›¿æ¢æœ€åä¸€ä¸ªå…¨è§’ï½ï¼Œé€‰åˆ°å…¨è§’ã€‚
    'ï½ã€‚'
    """
    # å®šä¹‰æ›¿æ¢å€™é€‰ï¼šåŒ…å«å…¨è§’/åŠè§’çš„.ã€!ï¼Œä»¥åŠç©ºå­—ç¬¦
    replacement_chars = [".", "ï¼", "ã€‚", "!", ""]
    # æ­£åˆ™åŒ¹é…ç»“å°¾çš„å…¨è§’ï½æˆ–åŠè§’~ï¼Œ[ï½~]åŒ¹é…ä¸¤ç§å­—ç¬¦ï¼Œ$é”šå®šè¡Œå°¾
    result = re.sub(
        pattern=r"[ï½~]$", repl=lambda _: random.choice(replacement_chars), string=s
    )
    return result


if __name__ == "__main__":
    import doctest

    empty_s = pandas.Series([], dtype="str")
    demo_s = pandas.Series([1, 2])
    empty_df = pandas.DataFrame()
    demo_df = pandas.DataFrame([{"x": 1}, {"x": 2}])
    mulline_text = r"äººå®¶\r\nç£å¸¦éä½†æ²¡è¢«æ·˜æ±°ï¼Œå®¹é‡è¿˜æ¯”ç¡¬ç›˜å¤§äº†123"
    s1 = "aa bb\ncc dd ee"
    mulline_text1 = "äººå®¶ 1213\r\nç£å¸¦éä½†æ²¡è¢«æ·˜æ±° å®¹é‡è¿˜æ¯”ç¡¬ç›˜å¤§äº†123"
    w_fpath = "D:\\workspace\\db\\sg\\meida\\0\\1764469092.9023788.xml"
    print(doctest.testmod(verbose=False, report=False))
